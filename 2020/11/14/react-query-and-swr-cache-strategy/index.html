<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>React Query、SWR 的 cache strategy &amp; 淺談 source code - Chih Yang&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="Chih Yang 的前端小天地">



<meta name="keywords" content="前端">



    <meta name="description" content="&amp;#x1F449; &amp;#x524D;&amp;#x8A00;&amp;#x7E7C;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7D39; React Query &amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x6CD5;&amp;#x5F8C;&amp;#xFF0C;&amp;#x63A5;&amp;#x8457;&amp;#x60F3;&amp;#x63A2;&amp;#x7D22;">
<meta property="og:type" content="article">
<meta property="og:title" content="React Query、SWR 的 cache strategy &amp; 淺談 source code">
<meta property="og:url" content="https://chihyang41.github.io/2020/11/14/react-query-and-swr-cache-strategy/index.html">
<meta property="og:site_name" content="Chih Yang&#39;s Blog">
<meta property="og:description" content="&amp;#x1F449; &amp;#x524D;&amp;#x8A00;&amp;#x7E7C;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x4ECB;&amp;#x7D39; React Query &amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x4F7F;&amp;#x7528;&amp;#x65B9;&amp;#x6CD5;&amp;#x5F8C;&amp;#xFF0C;&amp;#x63A5;&amp;#x8457;&amp;#x60F3;&amp;#x63A2;&amp;#x7D22;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://webdev.imgix.net/stale-while-revalidate/s-w-r-diagram.svg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/0081Kckwgy1gko3997nvsg30hs099jwv.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/donavon/hook-flow/master/hook-flow.png">
<meta property="og:image" content="https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg?hl=zh-tw">
<meta property="og:image" content="https://cythilya.github.io/assets/critical-rendering-path/requestAnimationFrame.png">
<meta property="article:published_time" content="2020-11-13T18:58:22.000Z">
<meta property="article:modified_time" content="2020-11-13T19:00:34.079Z">
<meta property="article:author" content="Chih Yang">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Front-End">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://webdev.imgix.net/stale-while-revalidate/s-w-r-diagram.svg">





<link rel="icon" href="https://upload.cc/i1/2020/03/05/MXS6WH.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146838618-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-146838618-1');
</script>


    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Chih Yang&#39;s Blog
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/tags">Tags</a>
            
            <a class="navbar-item "
               href="/categories">Categories</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/ChihYang41" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            React Query、SWR 的 cache strategy &amp; 淺談 source code
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-11-13T18:58:22.000Z" itemprop="datePublished">Nov 14 2020</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/frontend/">frontend</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            32 minutes read (About 4732 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><h2 id="&#x1F449;-&#x524D;&#x8A00;"><a href="#&#x1F449;-&#x524D;&#x8A00;" class="headerlink" title="&#x1F449; &#x524D;&#x8A00;"></a>&#x1F449; &#x524D;&#x8A00;</h2><p>&#x7E7C;&#x4E0A;&#x4E00;&#x7BC7;&#x4ECB;&#x7D39; React Query &#x7684;&#x57FA;&#x672C;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5F8C;&#xFF0C;&#x63A5;&#x8457;&#x60F3;&#x63A2;&#x7D22; React Query &#x4EE5;&#x53CA;&#x548C;&#x5B83;&#x76F8;&#x4F3C;&#x7684; SWR &#x9019;&#x5169;&#x500B; library &#x7684; cache strategy&#xFF0C;&#x9084;&#x6709;&#x5F9E; source code &#x770B;&#x5169;&#x8005;&#x7684; cache &#x5982;&#x4F55;&#x5BE6;&#x8E10;&#xFF0C;&#x4EE5;&#x53CA;&#x5F9E; SWR &#x7684; source code &#x4E2D;&#x89C0;&#x5BDF;&#x512A;&#x5316; UX&#x3001;DX &#x7684;&#x5C0F;&#x7D30;&#x7BC0;&#x3002;</p>
<a id="more"></a>

<h2 id="&#x1F449;-Cache-Strategy"><a href="#&#x1F449;-Cache-Strategy" class="headerlink" title="&#x1F449; Cache Strategy"></a>&#x1F449; Cache Strategy</h2><h3 id="stale-while-revalidate"><a href="#stale-while-revalidate" class="headerlink" title="stale-while-revalidate"></a>stale-while-revalidate</h3><blockquote>
<p>React Query caching is automatic out of the box. It uses a <code>stale-while-revalidate</code> in-memory caching strategy (popularized by <a href="https://tools.ietf.org/html/rfc5861" target="_blank" rel="noopener">HTTP RFC 5861</a>) and a very robust query deduping strategy to always ensure a query&#x2019;s data is always readily available, only cached when it&#x2019;s needed, even if that query is used multiple times across your application and updated in the background when possible.</p>
</blockquote>
<p>React Query &#x4EE5;&#x53CA; SWR &#x7684; cache strategy &#x662F;&#x57FA;&#x65BC; <code>stale-while-revalidate</code> &#x7684;&#x6982;&#x5FF5;&#x5BE6;&#x8E10;&#xFF0C;&#x751A;&#x9EBC;&#x662F; <code>stale-while-revalidate</code> &#x5462;&#xFF1F;&#x9084;&#x8A18;&#x5F97;&#x6709;&#x500B; HTTP header &#x53EB;&#x505A; <code>Cache-Control</code> &#x55CE;&#xFF1F;&#x81F3;&#x5C11;&#x6211;&#x662F;&#x4E0D;&#x592A;&#x8A18;&#x5F97;&#xFF0C;&#x90A3;&#x6642;&#x5019;&#x5C0D; <code>Cache-Control</code> &#x6700;&#x666E;&#x904D;&#x8A8D;&#x77E5;&#x7684;&#x662F;&#x88E1;&#x9762;&#x6709;&#x500B;&#x53EB; <code>max-age</code> &#x7684;&#x5C6C;&#x6027;&#x3002;</p>
<p>&#x8209;&#x4F8B;&#x4F86;&#x8AAA;&#xFF0C;&#x5047;&#x8A2D;&#x4ECA;&#x5929; header &#x8A2D;&#x7F6E;&#x4E86; <code>Cache-Control: max-age: 60</code>&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x300C;&#x6211;&#x7684;&#x8CC7;&#x6E90;&#x5728;&#x9019; 60 &#x79D2;&#x5167;&#x53D6;&#x7528;&#x5B83;&#x7684;&#x8A71;&#xFF0C;&#x5C31;&#x6703;&#x5F9E; cache &#x62FF;&#x300D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8AAA;&#x5728;&#x9019; 60 &#x79D2;&#x5167;&#x9019;&#x4EFD;&#x8CC7;&#x6599;&#x90FD;&#x6703;&#x662F;&#x65B0;&#x9BAE;&#x7684;&#xFF0C;&#x8981;&#x91CD;&#x8907;&#x4F7F;&#x7528;&#x5230;&#x5B83;&#x7684;&#x8A71;&#xFF0C;&#x53EA;&#x8981;&#x5F9E; cache &#x53D6;&#x51FA;&#x5C31;&#x597D;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x8DDF; server &#x62FF;&#xFF0C;&#x4F46;&#x904E;&#x4E86; 60 &#x79D2;&#x5F8C;&#x5C31;&#x5FC5;&#x9808;&#x8981;&#x518D;&#x8DDF; server &#x8981;&#x8CC7;&#x6599;&#xFF0C;&#x56E0;&#x70BA;&#x8CC7;&#x6599;&#x5DF2;&#x7D93;&#x904E;&#x671F;&#x4E86;&#x3002;</p>
<p><code>stale-while-revalidate</code> &#x5247;&#x662F; <code>Cache-Control</code> &#x7684; extension&#xFF08;spec &#x53EF;&#x53C3;&#x8003; <a href="https://tools.ietf.org/html/rfc5861" target="_blank" rel="noopener">HTTP RFC 5861</a>&#xFF09;&#x6211;&#x5011;&#x628A;&#x525B;&#x525B;&#x7684;&#x8209;&#x4F8B;&#x518D;&#x5EF6;&#x4F38;&#xFF0C;&#x9019;&#x6B21;&#x5C07; <code>Cache-Control</code> &#x8A2D;&#x7F6E;&#x6210; <code>Cache-Control: max-age=1, stale-while-revalidate=59</code>&#xFF0C;&#x610F;&#x601D;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x300C;&#x904E;&#x4E86; 1 &#x79D2;&#x5F8C;&#x6211;&#x7684;&#x8CC7;&#x6599;&#x6703;&#x904E;&#x671F;&#xFF0C;&#x4F46;&#x6C92;&#x95DC;&#x4FC2;&#xFF0C;&#x5728;&#x4E4B;&#x5F8C;&#x7684; 59 &#x79D2;&#x6211;&#x9084;&#x662F;&#x8981;&#x5F9E; cache &#x62FF;&#xFF0C;&#x53EA;&#x662F;&#x6703;&#x7528;&#x975E;&#x540C;&#x6B65;&#x3001;&#x80CC;&#x666F;&#x66F4;&#x65B0;&#x7684;&#x65B9;&#x5F0F;&#x53BB; revalidate&#xFF0C;&#x7B49;&#x5230; 60 &#x79D2;&#x4EE5;&#x5F8C;&#xFF0C;&#x6211;&#x7684;&#x8CC7;&#x6599;&#x771F;&#x6B63;&#x7684;&#x904E;&#x671F;&#x4E86;&#xFF0C;&#x624D;&#x6703;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F; revalidate cache&#x300D;</p>
<p>&#x4E0D;&#x5920;&#x6E05;&#x695A;&#x7684;&#x8A71;&#x6709;&#x4E0B;&#x9762;&#x5716;&#x4F8B;&#xFF1A;<br><img src="https://webdev.imgix.net/stale-while-revalidate/s-w-r-diagram.svg" alt="image"></p>
<blockquote>
<p>&#x6B64;&#x5716;&#x53D6;&#x81EA;&#x65BC; <a href="https://web.dev/stale-while-revalidate/" target="_blank" rel="noopener">Keeping things fresh with stale-while-revalidate</a></p>
</blockquote>
<p>&#x4EE5;&#x4E0A;&#x9762;&#x5716;&#x4F8B;&#x4F86;&#x8AAA;&#xFF1A;</p>
<ul>
<li>0 - 1 &#x79D2;&#x6642;&#xFF0C;&#x8CC7;&#x6599;&#x662F;&#x65B0;&#x9BAE;&#x7684;&#x7684;&#xFF0C;&#x5C31;&#x662F; <code>max-age: 1</code> &#x9810;&#x8A08;&#x6703;&#x6709;&#x7684;&#x884C;&#x70BA;&#x3002;</li>
<li>1 - 59 &#x79D2;&#x6642;&#xFF0C;&#x8CC7;&#x6599;&#x5DF2;&#x7D93;&#x904E;&#x671F;&#x4E86;&#xFF0C;&#x4F46;&#x56E0;&#x70BA; <code>stale-while-revalidate: 59</code> &#x7684;&#x95DC;&#x4FC2;&#xFF0C;&#x8868;&#x793A;&#x6211;&#x4E0D;&#x4ECB;&#x610F;&#x7E7C;&#x7E8C;&#x7528;&#x904E;&#x671F;&#x7684; cache&#xFF0C;&#x4F46;&#x540C;&#x6642;&#x6211;&#x6703;&#x5728;&#x80CC;&#x666F;&#x53BB; revalidate &#x6211;&#x7684; cache</li>
<li>60 &#x79D2;&#x5F8C;&#xFF0C;&#x4EE3;&#x8868;&#x6211;&#x8CC7;&#x6599;&#x771F;&#x6B63;&#x7684;&#x904E;&#x671F;&#x4E86;&#xFF0C;&#x5C31;&#x8D70;&#x4E00;&#x822C;&#x7684;&#x540C;&#x6B65; revalidate &#x65B9;&#x5F0F;</li>
</ul>
<h3 id="&#x548C;-React-Query&#x3001;SWR-&#x7684;&#x95DC;&#x806F;&#x662F;&#x751A;&#x9EBC;&#x5462;&#xFF1F;"><a href="#&#x548C;-React-Query&#x3001;SWR-&#x7684;&#x95DC;&#x806F;&#x662F;&#x751A;&#x9EBC;&#x5462;&#xFF1F;" class="headerlink" title="&#x548C; React Query&#x3001;SWR &#x7684;&#x95DC;&#x806F;&#x662F;&#x751A;&#x9EBC;&#x5462;&#xFF1F;"></a>&#x548C; React Query&#x3001;SWR &#x7684;&#x95DC;&#x806F;&#x662F;&#x751A;&#x9EBC;&#x5462;&#xFF1F;</h3><p>&#x525B;&#x525B;&#x6709;&#x8AAA;&#x5230;&#x9019;&#x5169;&#x500B; Library &#x90FD;&#x662F;&#x63A1;&#x7528; <code>stale-while-revaliate</code> &#x7684; cache strategy&#xFF0C;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x5F9E;&#x9019;&#x5169;&#x500B; library &#x5728;&#x64CD;&#x4F5C;&#x6642;&#x7684;&#x884C;&#x70BA;&#x4F86;&#x770B;&#x51FA;  <code>stale-while-revaliate</code> &#x6982;&#x5FF5;&#x7684;&#x5BE6;&#x8E10;&#xFF0C;&#x9019;&#x6642;&#x5019;&#x53C8;&#x8981;&#x5230;&#x9EDE;&#x5230;&#x6211;&#x5011;&#x4E4B;&#x524D;&#x7684; demo&#xFF1A;</p>
<p><a href="https://codesandbox.io/s/blissful-poincare-vxqv8?file=/src/App.js" target="_blank" rel="noopener">Star Wars Demo</a></p>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gko3997nvsg30hs099jwv.gif" alt="ezgif-6-01cf903e8474"></p>
<p>&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#x5230;&#x5728;&#x5207;&#x63DB;&#x300C;Planets&#x300D;&#x548C;&#x300C;People&#x300D;&#x7684;&#x6642;&#x5019;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x6703;&#x6709; loading &#x7684;&#x6587;&#x5B57;&#x986F;&#x793A;&#xFF0C;&#x4F46;&#x5728;&#x9019;&#x4E4B;&#x5F8C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x901F;&#x7684;&#x5207;&#x63DB;&#x9801;&#x9762;&#xFF0C;&#x4E26;&#x4E14;&#x8CC7;&#x6599;&#x5DF2;&#x7D93;&#x5448;&#x73FE;&#x51FA;&#x4F86;&#x4E86;&#xFF0C;&#x9019;&#x7576;&#x4E2D;&#x7684;&#x904B;&#x4F5C;&#x6D41;&#x7A0B;&#x662F;&#xFF1A;</p>
<blockquote>
<ol>
<li>&#x7B2C;&#x4E00;&#x6B21; render &#x672C;&#x4F86;&#x5C31;&#x6C92;&#x6709;&#x8CC7;&#x6599;&#xFF0C;&#x6240;&#x4EE5; call API &#x62FF;&#x8CC7;&#x6599;&#x3002;</li>
<li>&#x5448;&#x73FE; loading &#x6587;&#x5B57;&#x7D66;&#x4F7F;&#x7528;&#x8005;&#x770B;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#x6B21; render &#x6642;&#xFF0C;&#x56E0;&#x70BA;&#x6709;&#x4E0A;&#x4E00;&#x6B21; call API &#x7684;&#x8CC7;&#x6599; cache&#xFF0C;&#x6240;&#x4EE5;&#x5148;&#x5448;&#x73FE; cache &#x7D66;&#x4F7F;&#x7528;&#x8005;&#x770B;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8CC7;&#x6599;&#x548C;&#x4E0A;&#x4E00;&#x6B21; call API &#x6642;&#x76F8;&#x540C;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x6703;&#x8B8A;&#x52D5;&#xFF1B;&#x5982;&#x679C;&#x8CC7;&#x6599;&#x4E0D;&#x540C;&#xFF0C;&#x90A3;&#x5C31;&#x8B8A;&#x52D5;&#x756B;&#x9762;&#x3002;</li>
</ol>
</blockquote>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8AAA;&#x4F7F;&#x7528;&#x8005;&#x5728;&#x77ED;&#x671F;&#x5167;&#x5207;&#x63DB;&#x756B;&#x9762;&#x6642;&#xFF0C;&#x9AD4;&#x611F;&#x4E0A;&#x6703;&#x89BA;&#x5F97;&#x633A;&#x6D41;&#x66A2;&#x7684;&#xFF0C;&#x56E0;&#x70BA;&#x4ED6;&#x4E0D;&#x6703;&#x6BCF;&#x5207;&#x63DB;&#x4E00;&#x6B21;&#x756B;&#x9762;&#x5C31;&#x770B;&#x5230; loading&#xFF0C;&#x4F7F;&#x7528;&#x9AD4;&#x9A57;&#x5C31;&#x6703;&#x8B8A;&#x5F97;&#x6BD4;&#x8F03;&#x597D;&#x3002;</p>
<p>&#x5F9E; React Query &#x548C; SWR &#x300C;<strong>&#x6709; cache &#x5C31;&#x5148;&#x7AEF;&#x7D66;&#x4F7F;&#x7528;&#x8005;&#xFF0C;&#x4E26;&#x4E14;&#x5728;&#x80CC;&#x666F;&#x9ED8;&#x9ED8;&#x66F4;&#x65B0; cache</strong>&#x300D;&#x7684;&#x884C;&#x70BA;&#x4F86;&#x770B;&#xFF0C;&#x548C; <code>stale-while-revalidate</code> &#x7684;&#x6982;&#x5FF5;&#x5F88;&#x4E00;&#x81F4;&#x3002;</p>
<h2 id="&#x1F449;-React-Query&#x3001;SWR-Cache-&#x7684;&#x5BE6;&#x8E10;"><a href="#&#x1F449;-React-Query&#x3001;SWR-Cache-&#x7684;&#x5BE6;&#x8E10;" class="headerlink" title="&#x1F449; React Query&#x3001;SWR Cache &#x7684;&#x5BE6;&#x8E10;"></a>&#x1F449; React Query&#x3001;SWR Cache &#x7684;&#x5BE6;&#x8E10;</h2><p>&#x76EE;&#x524D;&#x53EA;&#x662F;&#x5F9E;&#x9019;&#x5169;&#x5957; library &#x7684;&#x4E00;&#x5C0F;&#x89D2;&#x4F86;&#x7ABA;&#x63A2;&#x5982;&#x4F55;&#x5BE6;&#x8E10;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x908F;&#x8F2F;&#x66F4;&#x70BA;&#x8907;&#x96DC;&#xFF0C;&#x5C0D; source code &#x7684;&#x7406;&#x89E3;&#x4E5F;&#x672A;&#x5FC5;&#x6B63;&#x78BA;&#xFF0C;&#x5982;&#x6709;&#x8AA4;&#x4E5F;&#x9EBB;&#x7169;&#x5927;&#x529B;&#x7CFE;&#x932F;&#xFF0C;&#x611F;&#x6069;&#x611F;&#x6069;&#x3002;</p>
<h3 id="React-Query"><a href="#React-Query" class="headerlink" title="React Query"></a>React Query</h3><p><a href="https://github.com/tannerlinsley/react-query/blob/69236d3e0bce712376767a86eac9246b304f6be6/src/core/queryCache.ts#L140" target="_blank" rel="noopener">React Query - getQueries</a></p>
<p>&#x6211;&#x6703;&#x5148;&#x5F9E; <code>QueryCache</code> &#x9019;&#x500B; class &#x7684; <code>getQueries</code> method &#x958B;&#x59CB;&#x770B;&#xFF0C;&#x56E0;&#x70BA; <code>getQueries</code> &#x662F;&#x5F9E; cache &#x4E2D;&#x6488;&#x51FA; query &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5F9E;&#x4E2D;&#x770B;&#x5230;&#x5169;&#x4EF6;&#x4E8B;&#xFF0C;&#x7B2C;&#x4E00;&#x662F; cache &#x7684;&#x8CC7;&#x6599;&#x7D50;&#x69CB;&#xFF0C;&#x4E5F;&#x662F;&#x6211;&#x5011;&#x4E3B;&#x8981;&#x60F3;&#x4E86;&#x89E3;&#x7684;&#xFF1B;&#x7B2C;&#x4E8C;&#x500B;&#x662F;&#x9806;&#x4FBF;&#x4E86;&#x89E3;&#x600E;&#x9EBC;&#x5B83;&#x662F;&#x600E;&#x9EBC;&#x53D6;&#x51FA; query &#x7684;&#x3002;</p>
<p>&#x5148;&#x770B; <code>getQueries</code> &#x6700;&#x5F8C;&#x4E00;&#x884C;&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.queriesArray.filter(predicateFn)</span><br></pre></td></tr></tbody></table></figure><br>&#x5F9E;&#x9019;&#x884C; code &#x53EF;&#x4EE5;&#x63A8;&#x6E2C; cache &#x7684;&#x8CC7;&#x6599;&#x7D50;&#x69CB;&#x662F; array&#xFF0C;&#x9054;&#x6210;&#x4E86;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x4F11;&#x606F;&#x4E86;&#xFF0C;&#x547C;&#x3002;<p></p>
<p>&#x4F11;&#x606F;&#x5B8C;&#x5F8C;&#x7E7C;&#x7E8C;&#x770B;&#x4E0B;&#x53BB;&#xFF0C;&#x6703;&#x770B;&#x5230;&#x53D6;&#x51FA;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x900F;&#x904E; filter &#x7684; <code>predicateFn</code> callback &#x5F97;&#x5230;&#x60F3;&#x8981;&#x7684; query&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x5011;&#x518D;&#x770B;&#x5230; <code>predicateFn</code>&#xFF1A;</p>
<p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> predicateFn: QueryPredicateFn</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> predicate === <span class="hljs-string">&apos;function&apos;</span>) {</span><br><span class="line">  predicateFn = predicate <span class="hljs-keyword">as</span> QueryPredicateFn</span><br><span class="line">} <span class="hljs-keyword">else</span> {</span><br><span class="line">  <span class="hljs-keyword">const</span> { exact, active, stale } = options || {}</span><br><span class="line">  <span class="hljs-keyword">const</span> resolvedConfig = <span class="hljs-keyword">this</span>.getResolvedQueryConfig(predicate)</span><br><span class="line"></span><br><span class="line">  predicateFn = <span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> {</span><br><span class="line">    <span class="hljs-comment">// Check query key if needed</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (!anyKey) {</span><br><span class="line">      <span class="hljs-keyword">if</span> (exact) {</span><br><span class="line">        <span class="hljs-comment">// Check if the query key matches exactly</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (query.queryHash !== resolvedConfig.queryHash) {</span><br><span class="line">          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">        }</span><br><span class="line">      } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-comment">// Check if the query key matches partially</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (!deepIncludes(query.queryKey, resolvedConfig.queryKey)) {</span><br><span class="line">          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Check active state if needed</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> active === <span class="hljs-string">&apos;boolean&apos;</span> &amp;&amp; query.isActive() !== active) {</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Check stale state if needed</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stale === <span class="hljs-string">&apos;boolean&apos;</span> &amp;&amp; query.isStale() !== stale) {</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5F9E; <code>predicateFn</code> &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B83;&#x5927;&#x6982;&#x505A;&#x4E86;&#x5E7E;&#x4EF6;&#x4E8B;&#xFF1A;</p>
<ol>
<li>&#x6AA2;&#x67E5; query key &#x7684; hash &#x662F;&#x5426;&#x76F8;&#x7B26;</li>
<li>&#x6AA2;&#x67E5;&#x72C0;&#x614B;&#x662F;&#x5426;&#x70BA; active</li>
<li>&#x6AA2;&#x67E5;&#x72C0;&#x614B;&#x662F;&#x5426;&#x70BA; stale</li>
</ol>
<p>&#x7D93;&#x904E;&#x5C64;&#x5C64;&#x6AA2;&#x67E5;&#x5F8C;&#x624D;&#x6703;&#x5230; return true&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5F9E; <code>query.queryHash</code> &#x4E5F;&#x80FD;&#x5920;&#x5927;&#x6982;&#x63A8;&#x77E5; query &#x7684; key &#x6703;&#x7D93;&#x904E; hash &#x5F8C;&#x653E;&#x5230; <code>queriesArray</code> &#x88E1;&#x3002;</p>
<h3 id="SWR"><a href="#SWR" class="headerlink" title="SWR"></a>SWR</h3><p>&#x63A5;&#x8457;&#x8F2A;&#x5230; SWR &#x4E86;&#x3002;</p>
<p><a href="https://github.com/vercel/swr/blob/master/src/cache.ts" target="_blank" rel="noopener">swr/src/cache.ts</a></p>
<p>&#x5148;&#x770B; SWR &#x7684; <code>class Cache</code> &#x88E1;&#x9762;&#x7684; constructor&#xFF1A;</p>
<p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">constructor</span>(initialData: any = {}) {</span><br><span class="line">  <span class="hljs-keyword">this</span>.__cache = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>(<span class="hljs-built_in">Object</span>.entries(initialData)) <span class="hljs-comment">// &#x9019;&#x884C;&#xFF01;</span></span><br><span class="line">  <span class="hljs-keyword">this</span>.__listeners = []</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#x548C; React Query Cache &#x7684; Array &#x4E0D;&#x540C;&#xFF0C;SWR &#x7684; Cache &#x662F;&#x7528; <code>Map</code> &#x9019;&#x500B;&#x8CC7;&#x6599;&#x7D50;&#x69CB;&#x4F86;&#x5BE6;&#x73FE;&#x7684;&#x3002;&#x7528; <code>Map</code> &#x4F86;&#x5BE6;&#x8E10;&#x6211;&#x89BA;&#x5F97;&#x883B;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x56E0;&#x70BA;&#x7121;&#x8AD6; React Query&#x3001;SWR &#x90FD;&#x6703;&#x628A; key &#x7D93;&#x904E; hash &#x5F8C;&#x7576;&#x4F5C;&#x90A3;&#x7B46;&#x8CC7;&#x6599;&#x7684; unique identifier&#xFF0C;&#x800C;&#x9019;&#x500B; unique identifier &#x5C31;&#x6703;&#x5C0D;&#x61C9;&#x5230;&#x76F8;&#x5C0D;&#x61C9;&#x7684; data&#xFF0C;&#x9019;&#x7A2E; key-value pairs &#x7684;&#x7D50;&#x69CB;&#x5C31;&#x883B;&#x9069;&#x5408;&#x4F7F;&#x7528;&#x5230; <code>Map</code> &#x7684;<p></p>
<p>&#x63A5;&#x8457;&#x7E7C;&#x7E8C;&#x5F80;&#x4E0B;&#x770B;&#x5176;&#x4ED6; Cache &#x7684; source code&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">get</span>(key: keyInterface): any {</span><br><span class="line">  <span class="hljs-keyword">const</span> [_key] = <span class="hljs-keyword">this</span>.serializeKey(key)</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__cache.get(_key)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">set</span>(key: keyInterface, value: any): any {</span><br><span class="line">  <span class="hljs-keyword">const</span> [_key] = <span class="hljs-keyword">this</span>.serializeKey(key)</span><br><span class="line">  <span class="hljs-keyword">this</span>.__cache.set(_key, value)</span><br><span class="line">  <span class="hljs-keyword">this</span>.notify()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">keys() {</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.from(<span class="hljs-keyword">this</span>.__cache.keys())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">has(key: keyInterface) {</span><br><span class="line">  <span class="hljs-keyword">const</span> [_key] = <span class="hljs-keyword">this</span>.serializeKey(key)</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__cache.has(_key)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">clear() {</span><br><span class="line">  <span class="hljs-keyword">this</span>.__cache.clear()</span><br><span class="line">  <span class="hljs-keyword">this</span>.notify()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">delete</span>(key: keyInterface) {</span><br><span class="line">  <span class="hljs-keyword">const</span> [_key] = <span class="hljs-keyword">this</span>.serializeKey(key)</span><br><span class="line">  <span class="hljs-keyword">this</span>.__cache.delete(_key)</span><br><span class="line">  <span class="hljs-keyword">this</span>.notify()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>&#x53EF;&#x4EE5;&#x767C;&#x73FE;&#x5230;&#x9019;&#x908A;&#x7121;&#x8AD6; get&#x3001;set &#x6216; clear &#x7B49;&#x7B49;&#xFF0C;&#x5176;&#x5BE6;&#x90FD;&#x662F; <code>Map</code> &#x5167;&#x5EFA;&#x7684; function&#xFF0C;&#x66F4;&#x8A73;&#x7D30;&#x7684;&#x5167;&#x5BB9;&#x53EF;&#x4EE5;&#x770B; <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="noopener">MDN - Map</a><p></p>
<h2 id="&#x1F449;-&#x5F9E;-SWR-source-code-&#x770B;&#x589E;&#x9032;-UX&#x3001;DX-&#x7684;&#x5C0F;&#x7D30;&#x7BC0;"><a href="#&#x1F449;-&#x5F9E;-SWR-source-code-&#x770B;&#x589E;&#x9032;-UX&#x3001;DX-&#x7684;&#x5C0F;&#x7D30;&#x7BC0;" class="headerlink" title="&#x1F449; &#x5F9E; SWR source code &#x770B;&#x589E;&#x9032; UX&#x3001;DX &#x7684;&#x5C0F;&#x7D30;&#x7BC0;"></a>&#x1F449; &#x5F9E; SWR source code &#x770B;&#x589E;&#x9032; UX&#x3001;DX &#x7684;&#x5C0F;&#x7D30;&#x7BC0;</h2><p>&#x63A5;&#x8457;&#x518D;&#x5F9E; SWR &#x7684; source code &#x6316;&#x6398;&#x5B83;&#x505A;&#x4E86;&#x4EC0;&#x9EBC;&#x589E;&#x9032; UX &#x548C; DX &#x7684;&#x5C0F;&#x7D30;&#x7BC0;&#xFF0C;&#x9019;&#x908A;&#x7684;&#x5C0F;&#x7D30;&#x7BC0;&#x662F;&#x6311;&#x6211;&#x6709;&#x8208;&#x8DA3;&#x7684;&#x90E8;&#x5206;&#x8B1B;&#x3002;</p>
<h3 id="useIsomorphicEffect"><a href="#useIsomorphicEffect" class="headerlink" title="useIsomorphicEffect"></a>useIsomorphicEffect</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// React currently throws a warning when using useLayoutEffect on the server.</span></span><br><span class="line"><span class="hljs-comment">// To get around it, we can conditionally useEffect on the server (no-op) and</span></span><br><span class="line"><span class="hljs-comment">// useLayoutEffect in the browser.</span></span><br><span class="line"><span class="hljs-keyword">const</span> useIsomorphicLayoutEffect = IS_SERVER ? useEffect : useLayoutEffect</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x9019;&#x908A;&#x6703;&#x767C;&#x73FE;&#x5728; Client Side Render &#x6642;&#xFF0C;SWR &#x4F7F;&#x7528; <code>useLayoutEffect</code>&#xFF0C;&#x5728; Server Side Render &#x6642;&#x4F7F;&#x7528; <code>useEffect</code>&#xFF1B;&#x5F9E;&#x8A3B;&#x89E3;&#x6703;&#x770B;&#x5230;&#x9019;&#x6A23;&#x505A;&#x7684;&#x539F;&#x56E0;&#x662F;&#x5728; Server Side Render &#x7684;&#x6642;&#x5019;&#x4F7F;&#x7528; <code>useLayoutEffect</code> &#x6703;&#x6709;&#x8B66;&#x544A;&#xFF0C;&#x56E0;&#x6B64;&#x624D;&#x505A;&#x4E86;&#x9019;&#x908A;&#x4E09;&#x5143;&#x904B;&#x7B97;&#x5B50;&#x7684;&#x5224;&#x65B7;&#x3002;</p>
<p>&#x81F3;&#x65BC;&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528; <code>useLayoutEffect</code> &#x5462;&#xFF1F;&#x8981;&#x5148;&#x5F9E; React Hooks &#x7684;&#x57F7;&#x884C;&#x6642;&#x6A5F;&#x8AAA;&#x8D77;&#xFF1A;</p>
<p><img src="https://raw.githubusercontent.com/donavon/hook-flow/master/hook-flow.png" alt></p>
<blockquote>
<p>&#x6B64;&#x5716;&#x4F86;&#x81EA;&#x65BC; donavon/hook-flow</p>
</blockquote>
<p>&#x5F9E;&#x4E0A;&#x5716;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>useLayoutEffect</code> &#x7684;&#x57F7;&#x884C;&#x6642;&#x6A5F;&#x5728; browser paints screen &#x4E4B;&#x524D;&#xFF1B;<code>useEffect</code> &#x5247;&#x662F;&#x5728;&#x700F;&#x89BD;&#x5668;&#x756B;&#x9762;&#x66F4;&#x65B0;&#x5F8C;&#x624D;&#x6703;&#x57F7;&#x884C;&#xFF0C;&#x4E5F;&#x56E0;&#x6B64;&#x7D71;&#x4E00;&#x6539;&#x6210; useLayoutEffect &#x5F8C;&#xFF0C;&#x57F7;&#x884C;&#x6642;&#x6A5F;&#x5C31;&#x6703;&#x66F4;&#x63D0;&#x65E9;&#x4E00;&#x4E9B;&#xFF0C;&#x8B93; SWR &#x6488;&#x8CC7;&#x6599;&#x3001;&#x8655;&#x7406;&#x8CC7;&#x6599;&#x7684;&#x6642;&#x6A5F;&#x66F4;&#x63D0;&#x524D;&#x3002;</p>
<p>&#x4E0D;&#x904E;&#x9019;&#x908A;&#x6211;&#x662F;&#x6709;&#x9EDE;&#x7591;&#x60D1;&#x7684;&#xFF0C;&#x6839;&#x64DA; React &#x5B98;&#x65B9;&#x6587;&#x4EF6;&#x7684;&#x8AAA;&#x6CD5;&#xFF1A;</p>
<blockquote>
<p><strong>Tip</strong><br>Unlike componentDidMount or componentDidUpdate, effects scheduled with useEffect don&#x2019;t block the browser from updating the screen. This makes your app feel more responsive. The majority of effects don&#x2019;t need to happen synchronously. In the uncommon cases where they do (such as measuring the layout), there is a separate useLayoutEffect Hook with an API identical to useEffect.</p>
</blockquote>
<blockquote>
<p><strong>&#x63D0;&#x793A;</strong><br>&#x8207; componentDidMount &#x6216; componentDidUpdate &#x4E0D;&#x540C;&#xFF0C;&#x4F7F;&#x7528; useEffect &#x5B89;&#x6392;&#x7684; effect &#x4E0D;&#x6703;&#x963B;&#x6B62;&#x700F;&#x89BD;&#x5668;&#x66F4;&#x65B0;&#x87A2;&#x5E55;&#x3002;&#x9019;&#x4F7F;&#x4F60;&#x7684;&#x61C9;&#x7528;&#x7A0B;&#x5F0F;&#x611F;&#x89BA;&#x8D77;&#x4F86;&#x97FF;&#x61C9;&#x66F4;&#x5FEB;&#x3002;&#x5927;&#x591A;&#x6578; effect &#x4E0D;&#x9700;&#x8981;&#x540C;&#x6B65;&#x767C;&#x751F;&#x3002;&#x5728;&#x5C11;&#x898B;&#x7684;&#x9700;&#x8981;&#x540C;&#x6B65;&#x767C;&#x751F;&#x7684;&#x60C5;&#x6CC1;&#x4E0B;&#xFF08;&#x4F8B;&#x5982;&#x6E2C;&#x91CF; layout&#xFF09;&#xFF0C;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x500B; useLayoutEffect Hook&#xFF0C;&#x5B83;&#x7684; API &#x8207; useEffect &#x76F8;&#x540C;&#x3002;</p>
</blockquote>
<p><code>useEffect</code> &#x5B89;&#x6392;&#x5728; render &#x5B8C;&#x5F8C;&#x57F7;&#x884C;&#x7684;&#x539F;&#x56E0;&#x662F;&#x5982;&#x679C; side effect &#x57F7;&#x884C;&#x904E;&#x4E45;&#x7684;&#x8A71;&#xFF0C;&#x5C31;&#x6703; block &#x700F;&#x89BD;&#x5668;&#x66F4;&#x65B0;&#x87A2;&#x5E55;&#xFF0C;&#x6240;&#x4EE5;&#x5927;&#x591A;&#x6578;&#x61C9;&#x7528;&#x60C5;&#x5883;&#x5B98;&#x65B9;&#x6703;&#x6BD4;&#x8F03;&#x63A8;&#x85A6;&#x4F7F;&#x7528; useEffect&#xFF0C;&#x56E0;&#x70BA;&#x4E0D;&#x6703;&#x963B;&#x6B62;&#x700F;&#x89BD;&#x5668;&#x66F4;&#x65B0;&#x87A2;&#x5E55;&#x3002;</p>
<p>&#x4E5F;&#x56E0;&#x70BA;&#x5982;&#x6B64;&#xFF0C;&#x6211;&#x6703;&#x6BD4;&#x8F03;&#x7591;&#x60D1;&#x7684;&#x5730;&#x65B9;&#x662F; SWR &#x6539;&#x6210;&#x4F7F;&#x7528; <code>useLayoutEffect</code> &#x4E0D;&#x6703;&#x6709; side effect &#x57F7;&#x884C;&#x904E;&#x4E45;&#x5C0E;&#x81F4; block UI paints &#x7684;&#x72C0;&#x6CC1;&#x55CE;&#xFF1F;</p>
<p>&#x6211;&#x731C;&#x4F9D;&#x7136;&#x662F;&#x56E0;&#x70BA;&#x57FA;&#x65BC; <code>stale-while-revalidate</code> &#x9019;&#x500B;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x7684;&#x95DC;&#x4FC2;&#xFF0C;&#x4F7F;&#x7528;&#x8005;&#x6703;&#x5148;&#x770B;&#x5230; cache &#xFF0C;&#x80CC;&#x666F;&#x6703;&#x9ED8;&#x9ED8;&#x66F4;&#x65B0; data&#xFF1B;&#x56E0;&#x70BA;&#x4F7F;&#x7528;&#x8005;&#x6703;&#x5148;&#x770B;&#x5230; cache&#xFF0C;&#x756B;&#x9762;&#x4E0A;&#x81F3;&#x5C11;&#x6709;&#x6771;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x6BD4;&#x8F03;&#x4E0D;&#x7528;&#x64D4;&#x5FC3;<code>useLayoutEffect</code> &#x57F7;&#x884C;&#x904E;&#x4E45;&#x5C0E;&#x81F4;&#x700F;&#x89BD;&#x5668;&#x66F4;&#x65B0;&#x87A2;&#x5E55;&#x88AB; block &#x7684;&#x554F;&#x984C;&#x3002;</p>
<h3 id="softRevalidate"><a href="#softRevalidate" class="headerlink" title="softRevalidate"></a>softRevalidate</h3><p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> softRevalidate = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> revalidate({ <span class="hljs-attr">dedupe</span>: <span class="hljs-literal">true</span> })</span><br></pre></td></tr></tbody></table></figure><br>&#x9019;&#x7B97;&#x662F;&#x6BD4;&#x8F03;&#x589E;&#x9032; DX &#x7684;&#x90E8;&#x4EFD;&#x3002;<p></p>
<p>&#x4E00;&#x822C;&#x4F86;&#x8AAA;&#x6211;&#x5011;&#x5728;&#x5BEB; React Hook &#x6642;&#xFF0C;&#x6703;&#x60F3;&#x8981;&#x628A;&#x91CD;&#x8907;&#x7684;&#x908F;&#x8F2F;&#x62BD;&#x51FA;&#x53BB;&#x8B8A;&#x6210; custom hook&#xFF0C;fetch data &#x7684;&#x908F;&#x8F2F;&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;&#x901A;&#x5E38;&#x6703;&#x5BEB;&#x6210;&#x50CF;&#x662F; <code>useFetch</code> &#x7684; custom hook&#xFF0C;&#x7A0B;&#x5F0F;&#x78BC;&#x6703;&#x50CF;&#x662F;&#x9019;&#x6A23;&#xFF1A;</p>
<p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useFetch</span>(<span class="hljs-params">url</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">const</span> [data, setData] = useState()</span><br><span class="line">  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = useState(<span class="hljs-literal">false</span>)</span><br><span class="line">  <span class="hljs-keyword">const</span> [isError, setIsError] = useState(<span class="hljs-literal">false</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</span><br><span class="line">    setIsLoading(<span class="hljs-literal">true</span>)</span><br><span class="line">      <span class="hljs-keyword">try</span> {</span><br><span class="line">        fetch(url)</span><br><span class="line">          .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.json())</span><br><span class="line">          .then(<span class="hljs-function">(<span class="hljs-params">json</span>) =&gt;</span> setData(json))</span><br><span class="line">      } <span class="hljs-keyword">catch</span> {</span><br><span class="line">        setIsError(<span class="hljs-literal">true</span>)</span><br><span class="line">      }</span><br><span class="line">        setIsLoading(<span class="hljs-literal">false</span>)</span><br><span class="line">  }, [url])</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">return</span> [data, isLoading, isError]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x63A5;&#x8457;&#x5047;&#x8A2D;&#x6211;&#x5011;&#x6709;&#x5169;&#x500B; Component&#xFF0C;Component A &#x548C; Component B&#xFF0C;&#x4E26;&#x4E14;&#x90FD;&#x7528;&#x5230;&#x4E86; <code>useFetch</code> &#x9019;&#x500B; hook&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentA</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">const</span> [data, isLoading, isError] = useFetch(<span class="hljs-string">&apos;https://swapi.dev/api/people/1&apos;</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentB</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">const</span> [data, isLoading, isError] = useFetch(<span class="hljs-string">&apos;https://swapi.dev/api/people/1&apos;</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x4E26;&#x4E14;&#x5728;&#x540C;&#x4E00;&#x500B;&#x9801;&#x9762;&#x88E1;&#x9762;&#x90FD;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x9019;&#x5169;&#x500B; Component&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;ComponentA/&gt;</span><br><span class="line">      &lt;ComponentB/&gt;</span><br><span class="line">    &lt;<span class="hljs-regexp">/&gt;</span></span><br><span class="line"><span class="hljs-regexp">  )</span></span><br><span class="line"><span class="hljs-regexp">}</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x9019;&#x6642;&#x5019;&#x6703;&#x767C;&#x751F;&#x4E00;&#x500B;&#x554F;&#x984C;&#xFF0C;&#x660E;&#x660E;&#x662F;&#x8981;&#x7528;&#x540C;&#x4E00;&#x4EFD; API &#x7684;&#x8CC7;&#x6599;&#xFF0C;&#x4F46;&#x662F;&#x537B; call &#x4E86;&#x540C;&#x4E00;&#x652F; API &#x5169;&#x6B21;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x767C;&#x4E86;&#x5169;&#x6B21;&#x62FF;&#x53D6;&#x540C;&#x6A23;&#x8CC7;&#x6599;&#x7684; request&#xFF0C;&#x9020;&#x6210;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x8CC7;&#x6E90;&#x6D6A;&#x8CBB;&#x3002;</p>
<p>&#x4F46; React Query &#x548C; SWR &#x4E0D;&#x6703;&#x767C;&#x751F;&#x9019;&#x7A2E;&#x72C0;&#x6CC1;&#xFF0C;&#x7576; query &#x7684; key &#x76F8;&#x540C;&#x7684;&#x6642;&#x5019;&#xFF0C;&#x5C31;&#x6703;&#x53BB;&#x6389;&#x91CD;&#x8907;&#x7684; request&#xFF0C;&#x53EA;&#x6703; call &#x4E00;&#x6B21; API&#x3002;</p>
<p>SWR &#x9019;&#x6BB5;&#x7A0B;&#x5F0F;&#x78BC;&#x5C31;&#x662F;&#x5728;&#x505A;&#x9019;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> softRevalidate = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> revalidate({ <span class="hljs-attr">dedupe</span>: <span class="hljs-literal">true</span> })</span><br></pre></td></tr></tbody></table></figure><br>dedupe &#x8A2D;&#x70BA; true &#x4E4B;&#x5F8C;&#xFF0C;&#x5C31;&#x6703;&#x53BB;&#x6389;&#x300C;&#x77ED;&#x6642;&#x9593;&#x300D;&#x5167;&#x91CD;&#x8907;&#x7684; request&#xFF0C;&#x4E0D;&#x904E;&#x9019;&#x500B;&#x300C;&#x77ED;&#x6642;&#x9593;&#x300D;&#x70BA;&#x591A;&#x5C11;&#x5462;&#xFF1F;&#x5728; SWR &#x7684;&#x9810;&#x8A2D;&#x70BA; 2 &#x79D2;&#xFF0C;&#x56E0;&#x6B64; 2 &#x79D2;&#x5167;&#x91CD;&#x8907;&#x7684; request &#x90FD;&#x6703;&#x88AB;&#x4F75;&#x70BA;&#x4E00;&#x6B21;&#xFF0C;&#x907F;&#x514D;&#x4E0D;&#x5FC5;&#x8981;&#x7684; request&#x3002;<p></p>
<h3 id="rIC-requestIdleCallback"><a href="#rIC-requestIdleCallback" class="headerlink" title="rIC - requestIdleCallback"></a>rIC - requestIdleCallback</h3><p>:warning: <strong>&#x76EE;&#x524D; rIC &#x5DF2;&#x7D93;&#x5728; 2020/11/2 <a href="https://github.com/vercel/swr/pull/744" target="_blank" rel="noopener">Replace rIC with rAF #744</a> &#x7684; PR &#x88AB;&#x6539;&#x6210; rAF</strong></p>
<p>&#x96D6;&#x7136;&#x539F;&#x672C; rIC &#x5DF2;&#x7D93;&#x88AB;&#x6539;&#x6210; rAF &#x4E86;&#xFF0C;&#x4F46;&#x9084;&#x662F;&#x5148;&#x5F9E;&#x4FEE;&#x6539;&#x524D;&#x7684; source code &#x4F86;&#x8AC7;&#x5427;&#xFF0C;&#x5F85;&#x6703;&#x518D;&#x4F86;&#x770B;&#x770B;&#x70BA;&#x4F55;&#x88AB;&#x6539;&#x6210; rAF&#x3002;</p>
<p>&#x5148;&#x770B;&#x770B; source code&#xFF1A;<br></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// polyfill for requestIdleCallback</span></span><br><span class="line"><span class="hljs-keyword">const</span> rIC = IS_SERVER</span><br><span class="line">  ? <span class="hljs-literal">null</span> : <span class="hljs-built_in">window</span>[<span class="hljs-string">&apos;requestAnimationFrame&apos;</span>] || (<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> setTimeout(f, <span class="hljs-number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//...&#x4E2D;&#x9593;&#x7565;</span></span><br><span class="line"></span><br><span class="line">useIsomorphicLayoutEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</span><br><span class="line">  <span class="hljs-comment">//...&#x4E2D;&#x9593;&#x7565;</span></span><br><span class="line">  </span><br><span class="line">  <span class="hljs-comment">// trigger a revalidation</span></span><br><span class="line">  <span class="hljs-keyword">if</span> (</span><br><span class="line">    config.revalidateOnMount ||</span><br><span class="line">    (!config.initialData &amp;&amp; config.revalidateOnMount === <span class="hljs-literal">undefined</span>)</span><br><span class="line">  ) {</span><br><span class="line">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> latestKeyedData !== <span class="hljs-string">&apos;undefined&apos;</span>) {</span><br><span class="line">    <span class="hljs-comment">// delay revalidate if there&apos;s cache</span></span><br><span class="line">    <span class="hljs-comment">// to not block the rendering</span></span><br><span class="line">      rIC(softRevalidate)</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">      softRevalidate()</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}, [key, revalidate])</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x5F9E;&#x8A3B;&#x89E3;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7576; <code>typeof latestKeyedData !== &apos;undefined&apos;</code> &#x6642;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7576;&#x6211;&#x5011;&#x6709; cache &#x7684;&#x6642;&#x5019;&#xFF0C;&#x6703;&#x57F7;&#x884C; <code>rIC</code> &#x9019;&#x500B; function&#xFF0C;&#x800C; <code>rIC</code> &#x4EE3;&#x8868;&#x7684;&#x5C31;&#x662F; Web APIs &#x4E2D;&#x7684; <code>requestIdleCallback</code>&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5011;&#x73FE;&#x5728;&#x53EF;&#x4EE5;&#x63A2;&#x8A0E;&#x7684;&#x53E6;&#x4E00;&#x500B;&#x554F;&#x984C;&#x662F; - &#x300C;<strong>&#x70BA;&#x4EC0;&#x9EBC;&#x8981;&#x7528; <code>requestIdleCallback</code>&#xFF1F;</strong>&#x300D;</p>
<h4 id="&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528;-requestIdleCallback&#xFF1F;&#x5148;&#x5F9E;&#x700F;&#x89BD;&#x5668;&#x8AC7;&#x8D77;"><a href="#&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528;-requestIdleCallback&#xFF1F;&#x5148;&#x5F9E;&#x700F;&#x89BD;&#x5668;&#x8AC7;&#x8D77;" class="headerlink" title="&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528; requestIdleCallback&#xFF1F;&#x5148;&#x5F9E;&#x700F;&#x89BD;&#x5668;&#x8AC7;&#x8D77;"></a>&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528; requestIdleCallback&#xFF1F;&#x5148;&#x5F9E;&#x700F;&#x89BD;&#x5668;&#x8AC7;&#x8D77;</h4><p>&#x8AC7;&#x9019;&#x500B;&#x554F;&#x984C;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x5011;&#x5148;&#x8AC7;&#x8AC7; JavaScript &#x8207;&#x700F;&#x89BD;&#x5668;&#x7684;&#x76F8;&#x8655;&#x6A21;&#x5F0F;&#xFF0C;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x524D;&#x56E0;&#x5F8C;&#x679C;&#x3002;</p>
<p>JavaScript &#x662F; single thread &#x7684;&#xFF0C;&#x700F;&#x89BD;&#x5668;&#x662F; muti thread &#x7684;&#xFF0C;&#x700F;&#x89BD;&#x5668;&#x9664;&#x4E86;&#x8655;&#x7406; JavaScript &#x7684; thread &#x4EE5;&#x5916;&#xFF0C;&#x9084;&#x6703;&#x6709; UI thread&#x3001;Network thread&#x3001;Main thread &#x7B49;&#x7B49;&#x3002;</p>
<p>&#x700F;&#x89BD;&#x5668;&#x7E6A;&#x88FD;&#x6BCF;&#x4E00;&#x500B; frame &#x7684;&#x6D41;&#x7A0B;&#x6703;&#x50CF;&#x662F;&#x9019;&#x6A23;&#xFF0C;&#x6703;&#x662F; JavaScript &#x5148;&#x57F7;&#x884C;&#xFF0C;UI thread &#x518D;&#x7E6A;&#x88FD;&#x756B;&#x9762;&#xFF1A;<br><img src="https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg?hl=zh-tw" alt></p>
<blockquote>
<p>&#x5716;&#x7247;&#x53D6;&#x81EA;&#x65BC; <a href="https://developers.google.com/web/fundamentals/performance/rendering?hl=zh-tw" target="_blank" rel="noopener">&#x8F49;&#x8B6F;&#x6548;&#x80FD;</a></p>
</blockquote>
<p>&#x70BA;&#x4EC0;&#x9EBC;&#x662F; JavaScript &#x5148;&#x57F7;&#x884C;&#x5462;&#xFF1F;&#x56E0;&#x70BA; JavaScript &#x6703;&#x6D89;&#x53CA;&#x5230; DOM &#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x4ECA;&#x5929; JavaScript &#x548C; UI thread &#x540C;&#x6642;&#x5728;&#x904B;&#x4F5C;&#x7684;&#x8A71;&#xFF0C;&#x756B;&#x9762;&#x53EF;&#x80FD;&#x5C31;&#x6703;&#x7522;&#x751F;&#x975E;&#x9810;&#x671F;&#x7684;&#x7D50;&#x679C;&#xFF0C;&#x56E0;&#x6B64; JavaScript &#x7684;&#x57F7;&#x884C;&#x548C; UI thread &#x662F;&#x4E0D;&#x80FD;&#x540C;&#x6642;&#x4F86;&#x7684;&#xFF0C;UI thread &#x6703;&#x5148;&#x7B49; JavaScript &#x57F7;&#x884C;&#x5B8C;&#x518D;&#x7E6A;&#x88FD;&#x756B;&#x9762;&#x3002;</p>
<p>&#x4E5F;&#x56E0;&#x70BA;&#x6709;&#x57F7;&#x884C;&#x5148;&#x5F8C;&#x9806;&#x5E8F;&#x7684;&#x95DC;&#x4FC2;&#xFF0C;&#x5047;&#x8A2D; JavaScript &#x57F7;&#x884C;&#x6642;&#x9593;&#x904E;&#x4E45;&#xFF0C;UI thread &#x5C31;&#x6703;&#x5728;&#x90A3;&#x908A;&#x82E6;&#x82E6;&#x7B49;&#x5F85;&#xFF0C;&#x89F8;&#x767C;&#x7684;&#x4E8B;&#x4EF6;&#x5C31;&#x6703;&#x7B49;&#x4E0D;&#x5230;&#x56DE;&#x61C9;&#xFF0C;&#x4F7F;&#x7528;&#x8005;&#x5C31;&#x6703;&#x89BA;&#x5F97;&#x9019;&#x7DB2;&#x9801;&#x5F88;&#x6162;&#x3002;</p>
<p>&#x4E0D;&#x904E;&#x300C;&#x57F7;&#x884C;&#x6642;&#x9593;&#x904E;&#x4E45;&#x300D;&#x597D;&#x50CF;&#x4E0D;&#x592A;&#x7CBE;&#x78BA;&#xFF0C;&#x600E;&#x9EBC;&#x6A23;&#x624D;&#x7B97;&#x662F;&#x592A;&#x4E45;&#x5462;&#xFF1F;&#x76EE;&#x524D;&#x5927;&#x90E8;&#x5206;&#x88DD;&#x7F6E;&#x90FD;&#x662F; 60 fps&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BCF;&#x4E00;&#x79D2; 60 &#x500B; frame&#xFF0C;&#x7D93;&#x904E;&#x63DB;&#x7B97;&#x5F8C;&#xFF0C;&#x5C07; 1 &#x79D2; / 60 (frames) &#x5F8C;&#xFF0C; &#x53EF;&#x4EE5;&#x5F97;&#x77E5;&#x4E00;&#x500B; frame &#x7684;&#x6642;&#x9593;&#x70BA; 16.67ms&#xFF08;&#x56DB;&#x6368;&#x4E94;&#x5165;&#xFF09;&#xFF0C;&#x800C;&#x4E00;&#x500B; frame &#x9664;&#x4E86; JavaScript &#x8981;&#x57F7;&#x884C;&#x4EE5;&#x5916;&#xFF0C;&#x700F;&#x89BD;&#x5668;&#x9084;&#x6709;&#x5176;&#x4ED6;&#x4F8B;&#x884C;&#x4EFB;&#x52D9;&#x8981;&#x505A;&#xFF0C;&#x6240;&#x4EE5; JavaScript &#x6BCF;&#x500B; frame &#x90FD;&#x8981;&#x5728; 10ms &#x5167;&#x5B8C;&#x6210;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x904E;&#x9019;&#x6642;&#x9593;&#x5C31;&#x6703;&#x6389;&#x5E40;&#xFF0C;&#x53EF;&#x80FD;&#x5C0E;&#x81F4;&#x7528;&#x6236;&#x89BA;&#x5F97;&#x7DB2;&#x9801;&#x4F7F;&#x7528;&#x8D77;&#x4F86;&#x4E0D;&#x592A;&#x6D41;&#x66A2;&#x3002;</p>
<p>&#x8B1B;&#x4E86;&#x9019;&#x9EBC;&#x591A;&#xFF0C;&#x7D42;&#x65BC;&#x53EF;&#x4EE5;&#x8AAA; <code>requestIdleCallback</code> &#x80FD;&#x5920;&#x7528;&#x4F86;&#x505A;&#x751A;&#x9EBC;&#x4E86;&#xFF01;</p>
<blockquote>
<p>&#x9019;&#x908A;&#x4F86;&#x5077;&#x5077;&#x8907;&#x7FD2;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x90A3;&#x5F35;&#x5716;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;<br><strong>JavaScript</strong> -&gt; <strong>Style</strong> -&gt; <strong>Layout</strong> -&gt; <strong>Paint</strong> -&gt; <strong>Composite</strong></p>
</blockquote>
<p><code>requestIdleCallback</code> &#x7684;&#x7528;&#x8655;&#x5C31;&#x662F;&#x5728;&#x300C;<strong>&#x6BCF;&#x4E00;&#x500B; frame &#x7684;&#x7A7A;&#x6A94;</strong>&#x300D;&#x57F7;&#x884C; callback&#xFF0C;&#x8981;&#x662F; JavaScript &#x57F7;&#x884C;&#x6642;&#x9593;&#x592A;&#x4E45;&#x6703;&#x5C0E;&#x81F4;&#x6389;&#x5E40;&#xFF0C;&#x90A3;&#x6211;&#x5011;&#x628A;&#x67D0;&#x4E9B;&#x6C92;&#x90A3;&#x9EBC;&#x512A;&#x5148;&#x7684;&#x4EFB;&#x52D9;&#x653E;&#x5728;&#x6BCF;&#x500B; frame &#x4E4B;&#x9593;&#x57F7;&#x884C;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6E1B;&#x5C11; JavaScript &#x57F7;&#x884C;&#x6642;&#x9593;&#xFF0C;&#x9032;&#x800C;&#x907F;&#x514D;&#x6389;&#x5E40;&#x7684;&#x53EF;&#x80FD;&#x6027;&#xFF0C;&#x7DB2;&#x9801;&#x4F7F;&#x7528;&#x8D77;&#x4F86;&#x6703;&#x6162;&#x7684;&#x98A8;&#x96AA;&#x5C31;&#x964D;&#x4F4E;&#x4E86;&#xFF01;&#x7C21;&#x55AE;&#x4F86;&#x8AAA;&#xFF0C;<code>requestIdleCallback</code> &#x5C31;&#x662F;&#x4E00;&#x500B;&#x5584;&#x7528;&#x7A7A;&#x9592;&#x6642;&#x9593;&#x7684; Web API&#x3002;</p>
<p><code>requestIdleCallback</code> &#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x5F48;&#x6027;&#x7684;&#x4F7F;&#x7528;&#x7A7A;&#x9593;&#xFF0C;&#x50CF;&#x662F;&#x53EF;&#x4EE5;&#x8A2D;&#x7F6E; <code>deadline</code>&#xFF0C;&#x4F86;&#x5224;&#x65B7;&#x9019;&#x500B; frame &#x4E2D;&#x9084;&#x6709;&#x591A;&#x5C11;&#x7A7A;&#x9592;&#x6642;&#x9593;&#xFF08;timeRemaining&#xFF09;&#x4F86;&#x5B8C;&#x6210;&#x4EFB;&#x52D9;&#xFF1B;&#x4EE5;&#x53CA;&#x6709; <code>timeout</code> &#x9019;&#x500B;&#x53C3;&#x6578;&#x80FD;&#x5920;&#x8A2D;&#x7F6E;&#xFF0C;&#x8868;&#x793A;&#x8D85;&#x904E;&#x9019;&#x500B;&#x6642;&#x9593;&#x5C31;&#x6703;&#x8B93;&#x700F;&#x89BD;&#x5668;&#x505C;&#x6B62;&#x624B;&#x908A;&#x5DE5;&#x4F5C;&#xFF0C;&#x5F37;&#x5236;&#x57F7;&#x884C;&#x4EFB;&#x52D9;&#x3002;</p>
<p>&#x53E6;&#x5916;&#x8981;&#x7279;&#x5225;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;<code>requestIdleCallback</code> &#x6700;&#x597D;&#x662F;&#x7528;&#x4F86;&#x9032;&#x884C;&#x4E00;&#x4E9B; JavaScript &#x7684;&#x904B;&#x7B97;&#x7B49;&#x7B49;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4E0D;&#x8981;&#x6D89;&#x53CA;&#x5230; DOM &#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x5982;&#x679C;&#x5728; <code>requestIdleCallback</code> &#x64CD;&#x4F5C;&#x5230; DOM&#xFF0C;&#x53C8;&#x6703;&#x89F8;&#x767C;&#x700F;&#x89BD;&#x5668;&#x53BB;&#x9032;&#x884C; Layout&#x3001;Paint &#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5C0E;&#x81F4; frame &#x7684;&#x57F7;&#x884C;&#x6642;&#x9593;&#x7121;&#x6CD5;&#x9810;&#x671F;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6D89;&#x53CA; DOM &#x7684;&#x64CD;&#x4F5C;&#x6642;&#xFF0C;&#x5EFA;&#x8B70;&#x4F7F;&#x7528; <code>requestAnimationFrame</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F85;&#x6703;&#x8981;&#x63D0;&#x5230;&#x7684; rAF&#x3002;</p>
<p><strong>&#x7E5E;&#x4E86;&#x9019;&#x9EBC;&#x4E45;&#xFF0C;&#x6240;&#x4EE5;&#x70BA;&#x751A;&#x9EBC;&#x8981;&#x7528; requestIdleCallback&#xFF1F;</strong></p>
<p>&#x524D;&#x60C5;&#x63D0;&#x8981;&#x7D50;&#x675F;&#x4E86;&#xFF0C;&#x6211;&#x5011;&#x518D;&#x56DE;&#x982D;&#x770B;&#x9019;&#x6BB5;&#x7A0B;&#x5F0F;&#x78BC;</p>
<p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> latestKeyedData !== <span class="hljs-string">&apos;undefined&apos;</span>) {</span><br><span class="line">  <span class="hljs-comment">// delay revalidate if there&apos;s cache</span></span><br><span class="line">  <span class="hljs-comment">// to not block the rendering</span></span><br><span class="line">  rIC(softRevalidate)</span><br><span class="line">} <span class="hljs-keyword">else</span> {</span><br><span class="line">  softRevalidate()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>&#x7576; <code>typeof latestKeyedData !== &apos;undefined&apos;</code> &#x7684;&#x6642;&#x5019;&#xFF0C;&#x5C31;&#x4EE3;&#x8868;&#x6211;&#x5011;&#x76EE;&#x524D;&#x662F;&#x6709; cache &#x7684;&#xFF0C;&#x4EE3;&#x8868;&#x4F7F;&#x7528;&#x8005;&#x300C;&#x76EE;&#x524D;&#x756B;&#x9762;&#x4E0A;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5167;&#x5BB9;&#x300D;&#xFF0C;&#x56E0;&#x70BA;&#x6211;&#x5011;&#x628A; cache &#x7684;&#x8CC7;&#x6599;&#x5148;&#x7AEF;&#x4E0A;&#x53BB;&#x7D66;&#x4F7F;&#x7528;&#x8005;&#x770B;&#x4E86;&#x3002;&#x6240;&#x4EE5; revalidate &#x9019;&#x4EF6;&#x4E8B;&#x5C31;&#x53EF;&#x4EE5;&#x7A0D;&#x5FAE;&#x5EF6;&#x5F8C;&#xFF0C;&#x5148;&#x4E0D;&#x8981; block &#x4F4F; rendering&#xFF0C;&#x800C;&#x662F;&#x5728;&#x6BCF;&#x4E00;&#x500B; frame &#x6709;&#x7A7A;&#x6A94;&#x7684;&#x6642;&#x5019;&#x57F7;&#x884C;&#x3002;</p>
<p>&#x5F9E; SWR &#x7684; source code &#x5C31;&#x80FD;&#x767C;&#x73FE;&#x5230;&#xFF0C;&#x5F88;&#x591A;&#x7A0B;&#x5F0F;&#x78BC;&#x4E0A;&#x7684;&#x5C0F;&#x7D30;&#x7BC0;&#xFF0C;&#x90FD;&#x570D;&#x7E5E;&#x8457;&#x300C;<code>stale-while-revalidate</code>&#x300D;&#x9019;&#x500B;&#x6838;&#x5FC3;&#x6982;&#x5FF5;&#x5728;&#x5EFA;&#x69CB;&#x9019;&#x5957; library&#x3002;</p>
<h4 id="&#x70BA;&#x4F55;&#x88AB;&#x6539;&#x6210;-rAF&#xFF1F;"><a href="#&#x70BA;&#x4F55;&#x88AB;&#x6539;&#x6210;-rAF&#xFF1F;" class="headerlink" title="&#x70BA;&#x4F55;&#x88AB;&#x6539;&#x6210; rAF&#xFF1F;"></a>&#x70BA;&#x4F55;&#x88AB;&#x6539;&#x6210; rAF&#xFF1F;</h4><p>&#x627F;&#x63A5;&#x4E0A;&#x4E00;&#x6BB5;&#xFF0C;<code>requestAnimationFrame</code> &#x6703;&#x5728; frame &#x7684;&#x6700;&#x521D;&#x57F7;&#x884C;&#xFF0C;&#x7528;&#x65BC;&#x512A;&#x5316;&#x700F;&#x89BD;&#x5668;&#x7684;&#x52D5;&#x756B;&#x6548;&#x80FD;&#x3001;&#x6216;&#x662F;&#x64CD;&#x4F5C; DOM &#x7684;&#x4EFB;&#x52D9;&#xFF0C;&#x5EF6;&#x7E8C;&#x4E0A;&#x4E00;&#x5F35;&#x5716;&#xFF0C;<code>requestAnimationFrame</code> &#x57F7;&#x884C;&#x6642;&#x6A5F;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://cythilya.github.io/assets/critical-rendering-path/requestAnimationFrame.png" alt></p>
<blockquote>
<p>&#x5716;&#x7247;&#x4F86;&#x6E90;&#xFF1A;<a href="https://cythilya.github.io/2018/06/26/animation-optimization/" target="_blank" rel="noopener">Making a Silky Smooth Web</a></p>
</blockquote>
<p>&#x4FEE;&#x6539;&#x70BA; rAF &#x7684;&#x8D77;&#x56E0;&#x662F;&#x4E00;&#x500B; issue&#xFF0C;&#x9023;&#x7D50;&#x5728;&#x6B64;&#xFF1A;<br><a href="https://github.com/vercel/swr/issues/731" target="_blank" rel="noopener">requestIdleCallback blocked by browser extensions</a></p>
<blockquote>
<p>Data isn&#x2019;t revalidating when certain browser extensions are installed. One I know for certain is <a href="https://chrome.google.com/webstore/detail/uivision-rpa/gcbalfbdmfieckjlnblleoemohcganoc" target="_blank" rel="noopener">UI.Vision RPA</a>. It appears to hold up <code>requestIdleCallback</code> from ever being called.</p>
</blockquote>
<p>&#x770B;&#x8D77;&#x4F86;&#x539F;&#x56E0;&#x662F; rIC &#x6703;&#x56E0;&#x70BA;&#x5B89;&#x88DD;&#x4E86;&#x67D0;&#x4E9B; browser extensions &#x5C0E;&#x81F4;&#x88AB; block &#x4F4F;&#xFF0C;&#x6C92;&#x8FA6;&#x6CD5; revalidate&#x3002;</p>
<p>&#x66AB;&#x6642;&#x6027;&#x7684;&#x89E3;&#x6CD5;&#x662F;&#x8A2D;&#x7F6E; <code>timeout</code>&#xFF0C;&#x56E0;&#x70BA;&#x525B;&#x525B;&#x6709;&#x63D0;&#x904E;&#xFF0C;&#x8A2D;&#x7F6E; <code>timeout</code> &#x53EF;&#x4EE5;&#x5728;&#x8D85;&#x904E;&#x9810;&#x5B9A;&#x7684;&#x6642;&#x9593;&#x5F8C;&#xFF0C;&#x8B93;&#x700F;&#x89BD;&#x5668;&#x5F37;&#x5236;&#x57F7;&#x884C; <code>rIC</code> &#x7684; callback&#x3002;</p>
<p>&#x4E0D;&#x904E;&#x7DAD;&#x8B77;&#x8005;&#x63D0;&#x8B70;&#x53EF;&#x4EE5;&#x5C07; <code>requestIdleCallback</code> &#x6539;&#x70BA; <code>requestAnimationFrame</code>&#xFF0C;&#x56E0;&#x6B64;&#x5728; <a href="https://github.com/vercel/swr/pull/744" target="_blank" rel="noopener">Replace rIC with rAF #744</a> &#x9019;&#x4EFD; PR &#x5C31;&#x88AB;&#x6539;&#x6210; rAF &#x4E86;&#x3002;</p>
<p>&#x81F3;&#x65BC;&#x7DAD;&#x8B77;&#x8005;&#x66F4;&#x6DF1;&#x5165;&#x7684;&#x8003;&#x91CF;&#xFF0C;&#x4EE5;&#x53CA;&#x9019;&#x500B; bug &#x66F4;&#x6DF1;&#x5165;&#x7684;&#x8D77;&#x56E0;&#xFF0C;&#x56E0;&#x70BA;&#x672C;&#x4EBA;&#x529F;&#x529B;&#x5C1A;&#x6DFA;&#x9084;&#x7121;&#x6CD5;&#x89E3;&#x91CB;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4EBA;&#x80FD;&#x5E6B;&#x5FD9;&#x89E3;&#x7B54;&#x90A3;&#x6211;&#x6703;&#x975E;&#x5E38;&#x611F;&#x8B1D; QQ</p>
<h2 id="&#x1F449;-&#x7D50;&#x8A9E;"><a href="#&#x1F449;-&#x7D50;&#x8A9E;" class="headerlink" title="&#x1F449; &#x7D50;&#x8A9E;"></a>&#x1F449; &#x7D50;&#x8A9E;</h2><p>&#x9019;&#x6B21;&#x5F9E; React Query&#x3001;SWR &#x7684;&#x5B98;&#x65B9;&#x6587;&#x4EF6;&#x9577;&#x4E86;&#x4E00;&#x4E9B;&#x77E5;&#x8B58;&#xFF0C;&#x77E5;&#x9053;&#x4E86; <code>stale-while-revalidate</code> &#x9019;&#x500B; cache strategy&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x9019;&#x4E5F;&#x662F;&#x9996;&#x6B21;&#x7528;&#x4E0D;&#x4E00;&#x6A23;&#x7684;&#x89D2;&#x5EA6;&#x53BB;&#x770B; source code&#xFF0C;&#x4EE5;&#x5F80;&#x6C92;&#x6709;&#x90A3;&#x9EBC;&#x5E38;&#x53BB;&#x770B; source code&#xFF0C;&#x53BB;&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x4E00;&#x500B; library &#x662F;&#x5982;&#x4F55;&#x5BE6;&#x8E10;&#x7684;&#xFF1B;&#x901A;&#x5E38;&#x662F;&#x9047;&#x5230; bug&#x3001;&#x6216;&#x662F;&#x55AE;&#x7D14;&#x60F3;&#x4E86;&#x89E3;&#x67B6;&#x69CB;&#x624D;&#x6709;&#x6A5F;&#x6703;&#x7FFB; source code&#xFF0C;&#x4F46;&#x9019;&#x6B21;&#x4E0D;&#x592A;&#x4E00;&#x6A23;&#xFF0C;&#x662F;&#x51FA;&#x65BC;&#x597D;&#x5947;&#x5FC3;&#xFF0C;&#x60F3;&#x77E5;&#x9053;&#x600E;&#x9EBC;&#x505A;&#x7684;&#xFF0C;&#x624D;&#x958B;&#x59CB;&#x9019;&#x8D9F;&#x7FFB;&#x627E; source code &#x7684;&#x65C5;&#x7A0B;&#xFF0C;&#x4E26;&#x5F9E; library &#x7684;&#x6838;&#x5FC3;&#x7406;&#x5FF5;&#x958B;&#x59CB;&#x63A2;&#x7A76;&#x8D77;&#x300C;&#x70BA;&#x4F55;&#x662F;&#x9019;&#x6A23;&#x5BEB;&#xFF1F;&#x300D;&#x3002;&#x4E0D;&#x904E;&#x540C;&#x6642;&#x4E5F;&#x6DF1;&#x6DF1;&#x611F;&#x53D7;&#x5230;&#x4E86;&#x529F;&#x529B;&#x7684;&#x4E0D;&#x8DB3;&#xFF0C;&#x5C0E;&#x81F4;&#x90E8;&#x5206;&#x7684;&#x89E3;&#x8B80;&#x5E36;&#x6709;&#x4E0D;&#x78BA;&#x5B9A;&#x6027;&#xFF0C;&#x6291;&#x6216;&#x662F;&#x4E0D;&#x592A;&#x4E86;&#x89E3;&#x7DAD;&#x8B77;&#x8005;&#x7684;&#x6539;&#x52D5;&#x51FA;&#x81EA;&#x4F55;&#x7A2E;&#x539F;&#x56E0;&#xFF0C;&#x770B; source code &#x7684;&#x901F;&#x5EA6;&#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x5FEB;&#xFF0C;&#x9019;&#x90E8;&#x5206;&#x9084;&#x9700;&#x8981;&#x591A;&#x52A0;&#x52AA;&#x529B; QQ</p>
<p>&#x6700;&#x5F8C;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x7AE0;&#x6709;&#x4EFB;&#x4F55;&#x932F;&#x8AA4;&#x4E5F;&#x9EBB;&#x7169;&#x4E0D;&#x541D;&#x6307;&#x6B63; &#x1F9D0;</p>
<h2 id="&#x1F449;-References"><a href="#&#x1F449;-References" class="headerlink" title="&#x1F449; References"></a>&#x1F449; References</h2><p>&#x6700;&#x5F8C;&#x7684;&#x6700;&#x5F8C;&#xFF0C;&#x611F;&#x8B1D;&#x7121;&#x6578;&#x7121;&#x79C1;&#x7684;&#x958B;&#x767C;&#x8005;&#x5206;&#x4EAB;&#x6240;&#x5B78;&#xFF0C;&#x4EE5;&#x4E0B;&#x5217;&#x51FA;&#x7684;&#x53C3;&#x8003;&#x8CC7;&#x6599;&#x5927;&#x5927;&#x5E6B;&#x52A9;&#x9019;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x69CB;&#x6210;&#x3002;</p>
<p><a href="https://github.com/vercel/swr" target="_blank" rel="noopener">vercel/swr</a></p>
<p><a href="https://github.com/tannerlinsley/react-query" target="_blank" rel="noopener">tannerlinsley/react-query</a></p>
<p><a href="https://developers.google.com/web/updates/2015/08/using-requestidlecallback" target="_blank" rel="noopener">Using requestIdleCallback</a></p>
<p><a href="https://medium.com/d-d-mag/%E5%96%84%E7%94%A8%E7%A9%BA%E9%96%91%E6%99%82%E9%96%93-requestidlecallback-744a9d75faba" target="_blank" rel="noopener">requestIdleCallback &#x2014; &#x5584;&#x7528;&#x7A7A;&#x9591;&#x6642;&#x9593;</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/60307571" target="_blank" rel="noopener">&#x6DF1;&#x5165;&#x5256;&#x6790; React Concurrent</a></p>
<p><a href="https://developers.google.com/web/fundamentals/performance/rendering?hl=zh-tw" target="_blank" rel="noopener">&#x8F49;&#x8B6F;&#x6548;&#x80FD;</a></p>
<p><a href="https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution?hl=zh-tw" target="_blank" rel="noopener">&#x6700;&#x4F73;&#x5316; JavaScript &#x57F7;&#x884C;</a></p>
<p><a href="https://cythilya.github.io/2018/06/26/animation-optimization/" target="_blank" rel="noopener">&#x5982;&#x4F55;&#x63D0;&#x5347;&#x52D5;&#x756B;&#x6548;&#x80FD;&#xFF1F;</a></p>
<p><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/Window.requestAnimationFrame" target="_blank" rel="noopener">Window.requestAnimationFrame()</a></p>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/React/">#React</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Front-End/">#Front-End</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-prev">
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2020/09/07/React-Query-Tutorial/">React Query Tutorial</a>
            
        </span>
    </div>
    
</article>


<div class="sharebox">
    
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5e4221ec7a88780012e1744e&amp;product=inline-share-buttons' async='async'></script>

</div>



<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://chihyang41.github.io/2020/11/14/react-query-and-swr-cache-strategy/';
        this.page.identifier = '2020/11/14/react-query-and-swr-cache-strategy/';
        
        this.language = 'en';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'ChihYang41-blog' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 Chih Yang&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/ChihYang41" target="_blank" rel="noopener">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>
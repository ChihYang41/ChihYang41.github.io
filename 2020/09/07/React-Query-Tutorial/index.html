<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="pdI9OcgtLe0I27rizFD2U3s553wFM8nsth5viFyCbOk">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chihyang41.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="å‰è¨€data fetching åœ¨ React è£¡ä¸€ç›´æ˜¯æˆ‘æ„Ÿåˆ°ä¸å¤ªè‡ªåœ¨çš„ä¸€å¡Šï¼Œä¸»è¦æ˜¯ä¾†è‡ªæ–¼æˆ‘å­¸è—ä¸ç²¾ï¼Œæˆ‘çŸ¥é“ React å·²ç¶“æœ‰éƒ¨åˆ†çš„ pattern åœ¨è™•ç†é€™ä¸€å¡Šäº†ï¼Œç›®å‰æœ€å¸¸ç”¨åˆ°çš„å°±æ˜¯ Redux + Redux middlewaresï¼ˆRedux thunkã€Redux saga ç­‰ç­‰ï¼‰ï¼Œå‰é™£å­å‰‡æ˜¯é–‹å§‹è©¦è‘—ç”¨ custom hook ä¾†è™•ç†é€™å¡Šï¼Œæ„Ÿè¦ºå¾ˆä¸è³´ï¼Œä½†æ¯”å¦‚ cache ç­‰ç­‰çš„äº‹æƒ…ä¾ç„¶éº»">
<meta property="og:type" content="article">
<meta property="og:title" content="React Query Tutorial">
<meta property="og:url" content="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/index.html">
<meta property="og:site_name" content="Chih Yang&#39;s Blog">
<meta property="og:description" content="å‰è¨€data fetching åœ¨ React è£¡ä¸€ç›´æ˜¯æˆ‘æ„Ÿåˆ°ä¸å¤ªè‡ªåœ¨çš„ä¸€å¡Šï¼Œä¸»è¦æ˜¯ä¾†è‡ªæ–¼æˆ‘å­¸è—ä¸ç²¾ï¼Œæˆ‘çŸ¥é“ React å·²ç¶“æœ‰éƒ¨åˆ†çš„ pattern åœ¨è™•ç†é€™ä¸€å¡Šäº†ï¼Œç›®å‰æœ€å¸¸ç”¨åˆ°çš„å°±æ˜¯ Redux + Redux middlewaresï¼ˆRedux thunkã€Redux saga ç­‰ç­‰ï¼‰ï¼Œå‰é™£å­å‰‡æ˜¯é–‹å§‹è©¦è‘—ç”¨ custom hook ä¾†è™•ç†é€™å¡Šï¼Œæ„Ÿè¦ºå¾ˆä¸è³´ï¼Œä½†æ¯”å¦‚ cache ç­‰ç­‰çš„äº‹æƒ…ä¾ç„¶éº»">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1giha9kf5brj31gi0u0tgv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihabcdeeej31gi0u0gtl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihbw2bgddg30nw0hghdt.gif">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihczyiibeg30nw0hgqv5.gif">
<meta property="article:published_time" content="2020-09-06T16:34:24.000Z">
<meta property="article:modified_time" content="2020-09-06T16:34:24.000Z">
<meta property="article:author" content="Chih Yang">
<meta property="article:tag" content="Front-End">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg">


<link rel="canonical" href="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>React Query Tutorial | Chih Yang's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146838618-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-146838618-1');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/images/logo.png" alt="Chih Yang's Blog">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chih Yang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-%E7%82%BA%E4%BD%95%E8%A6%81%E4%BD%BF%E7%94%A8%EF%BC%9F%E5%A6%82%E6%9E%9C%E4%B8%8D%E7%94%A8%E5%AE%83%E6%9C%83%E6%80%8E%E9%BA%BC%E6%A8%A3%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">ğŸ‘‰ ç‚ºä½•è¦ä½¿ç”¨ï¼Ÿå¦‚æœä¸ç”¨å®ƒæœƒæ€éº¼æ¨£ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-Getting-Started"><span class="nav-number">3.</span> <span class="nav-text">ğŸ‘‰ Getting Started</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%96%8B%E5%A7%8B%E5%89%8D%E7%9A%84%E9%A0%88%E7%9F%A5-React-Query-%E7%9A%84%E9%A0%90%E8%A8%AD%E8%A1%8C%E7%82%BA"><span class="nav-number">3.1.</span> <span class="nav-text">é–‹å§‹å‰çš„é ˆçŸ¥ - React Query çš„é è¨­è¡Œç‚º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useQuery"><span class="nav-number">3.2.</span> <span class="nav-text">useQuery</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9B%B3%EF%B8%8F-%E4%BB%BB%E5%8B%99%E7%9B%AE%E6%A8%99"><span class="nav-number">3.2.1.</span> <span class="nav-text">â›³ï¸ ä»»å‹™ç›®æ¨™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9B%B3%EF%B8%8F-%E5%A6%82%E4%BD%95%E5%9F%B7%E8%A1%8C"><span class="nav-number">3.2.2.</span> <span class="nav-text">â›³ï¸ å¦‚ä½•åŸ·è¡Œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%80%E4%BB%A5%E2%80%A6%E5%92%8C-useFetch-Hook-%E5%B7%AE%E5%9C%A8%E5%93%AA%E5%91%A2%EF%BC%9F"><span class="nav-number">3.2.3.</span> <span class="nav-text">æ‰€ä»¥â€¦å’Œ useFetch Hook å·®åœ¨å“ªå‘¢ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Query-DevTool"><span class="nav-number">3.3.</span> <span class="nav-text">React Query DevTool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E5%88%86%E9%A0%81%E6%80%8E%E9%BA%BC%E5%81%9A%EF%BC%9FusePagination%EF%BC%81"><span class="nav-number">3.4.</span> <span class="nav-text">å¦‚æœæƒ³è¦åˆ†é æ€éº¼åšï¼ŸusePaginationï¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#key"><span class="nav-number">3.4.1.</span> <span class="nav-text">key</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usePaginatedQuery"><span class="nav-number">3.5.</span> <span class="nav-text">usePaginatedQuery</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-%E7%B5%90%E8%AA%9E"><span class="nav-number">4.</span> <span class="nav-text">ğŸ‘‰ çµèª</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%85%E7%A0%94%E7%A9%B6%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="nav-number">4.1.</span> <span class="nav-text">å¾…ç ”ç©¶çš„å•é¡Œ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-Refercences"><span class="nav-number">5.</span> <span class="nav-text">ğŸ‘‰ Refercences</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chih Yang</p>
  <div class="site-description" itemprop="description">Chih Yang çš„å‰ç«¯å°å¤©åœ°</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ChihYang41" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;ChihYang41" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/chihyang41" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;chihyang41" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ChihYang41" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chih Yang">
      <meta itemprop="description" content="Chih Yang çš„å‰ç«¯å°å¤©åœ°">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chih Yang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React Query Tutorial
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-07 00:34:24" itemprop="dateCreated datePublished" datetime="2020-09-07T00:34:24+08:00">2020-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/frontend/" itemprop="url" rel="index"><span itemprop="name">frontend</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>data fetching åœ¨ React è£¡ä¸€ç›´æ˜¯æˆ‘æ„Ÿåˆ°ä¸å¤ªè‡ªåœ¨çš„ä¸€å¡Šï¼Œä¸»è¦æ˜¯ä¾†è‡ªæ–¼æˆ‘å­¸è—ä¸ç²¾ï¼Œæˆ‘çŸ¥é“ React å·²ç¶“æœ‰éƒ¨åˆ†çš„ pattern åœ¨è™•ç†é€™ä¸€å¡Šäº†ï¼Œç›®å‰æœ€å¸¸ç”¨åˆ°çš„å°±æ˜¯ Redux + Redux middlewaresï¼ˆRedux thunkã€Redux saga ç­‰ç­‰ï¼‰ï¼Œå‰é™£å­å‰‡æ˜¯é–‹å§‹è©¦è‘—ç”¨ custom hook ä¾†è™•ç†é€™å¡Šï¼Œæ„Ÿè¦ºå¾ˆä¸è³´ï¼Œä½†æ¯”å¦‚ cache ç­‰ç­‰çš„äº‹æƒ…ä¾ç„¶éº»ç…©ï¼Œæ‰€ä»¥æˆ‘åœ¨å°‹æ‰¾æœ‰æ²’æœ‰æ›´å¥½çš„ä½œæ³•ã€‚</p>
<p>æœ€è¿‘çœ‹åˆ°äº† React Queryï¼Œä½¿ç”¨èµ·ä¾†è¦ºå¾—å¾ˆè®šè®šï¼Œæ–‡ä»¶èªªæ˜æ¸…æ¥šã€API å°‘å°‘çš„å¾ˆç°¡å–®ï¼Œå¾ˆç¬¦åˆæˆ‘å¿ƒç›®ä¸­å¥½ç”¨çš„ data fetching hookï¼Œä¸éç›®å‰ä¹Ÿæ²’æœ‰ç”¨å¾ˆæ·±ï¼Œæ›´å¤šçš„å‘æˆ–æ˜¯æ‡‰ç”¨å ´æ™¯é‚„æ²’æœ‰é‡åˆ°ï¼Œæ‰€ä»¥ä½¿ç”¨å¿ƒå¾—å¯èƒ½é‚„è¦å†ä¸€é™£å­æ‰æœƒæœ‰ï¼Œé€™ç¯‡çš„ç›®çš„å°±æ˜¯åšåšç­†è¨˜ï¼Œæä¾›æ—¥å¾Œçš„è‡ªå·±å›é¡§ã€‚</p>
<span id="more"></span>

<h2 id="ğŸ‘‰-ç‚ºä½•è¦ä½¿ç”¨ï¼Ÿå¦‚æœä¸ç”¨å®ƒæœƒæ€éº¼æ¨£ï¼Ÿ"><a href="#ğŸ‘‰-ç‚ºä½•è¦ä½¿ç”¨ï¼Ÿå¦‚æœä¸ç”¨å®ƒæœƒæ€éº¼æ¨£ï¼Ÿ" class="headerlink" title="ğŸ‘‰ ç‚ºä½•è¦ä½¿ç”¨ï¼Ÿå¦‚æœä¸ç”¨å®ƒæœƒæ€éº¼æ¨£ï¼Ÿ"></a>ğŸ‘‰ ç‚ºä½•è¦ä½¿ç”¨ï¼Ÿå¦‚æœä¸ç”¨å®ƒæœƒæ€éº¼æ¨£ï¼Ÿ</h2><p>å¦‚æœä½¿ç”¨ Redux ä¸€æ®µæ™‚é–“å¾Œï¼Œæ‡‰è©²æœƒç™¼ç¾ Global State å¤§è‡´ä¸Šå¯ä»¥åˆ†æˆå…©ç¨®é¡å‹ï¼Œä¸€ç¨®æ˜¯é—œæ–¼æ•´å€‹ Web App çš„å…§éƒ¨ç‹€æ…‹ï¼Œæ¯”å¦‚ toggleã€alertï¼Œé€™é¡ç‹€æ…‹ä¸éœ€è¦ cacheï¼Œåˆæˆ–æ˜¯å…¶ä»–çš„è™•ç†ï¼›å¦ä¸€ç¨®å‰‡æ˜¯éœ€è¦ç¶“ééåŒæ­¥ç²å–çš„è³‡æ–™ï¼Œåƒæ˜¯ call API æ‰èƒ½æ‹¿åˆ°çš„ dataã€ç™»å…¥çš„ token ç­‰ç­‰ã€‚</p>
<p>åŸæœ¬ Redux çš„ç¤¾ç¾¤ç‚ºäº†è™•ç†é€™é¡éåŒæ­¥çš„ stateï¼Œèª•ç”Ÿäº†åƒæ˜¯ redux-thunkã€redux-sagaã€redux-observable ç­‰ middlewares ä¾†è™•ç†ç›¸é—œé‚è¼¯ï¼Œç‚ºçš„æ˜¯è®“é‚è¼¯åˆ†å·¥æ›´ç‚ºæ˜ç¢ºï¼ŒæŒç®¡ View çš„ Component å°±è² è²¬é¡¯ç¤ºç•«é¢ï¼Œcall API é‚è¼¯å°±åœ¨ middlewares ä¸­è™•ç†ï¼Œä½†æ™‚é–“ä¸€ä¹…ä½ é‚„æ˜¯æœƒç™¼ç¾ reducers ä¸­åˆ†æ•£äº†å„é¡çš„ stateï¼Œä¹Ÿå°±æ˜¯åŒæ­¥çš„ state å’ŒéåŒæ­¥çš„ state æ··é›œå†ä¸€èµ·ã€‚</p>
<p>React Query å°±æ˜¯å› æ‡‰è€Œç”Ÿçš„ï¼Œä½œè€…å°‡ global state å€åˆ†ç‚º Client state å’Œ Server Stateï¼ŒClient state å°±æ˜¯å‰é¢æ®µè½èªªçš„ Web App å…§éƒ¨ç‹€æ…‹ï¼Œä½ å¯ä»¥ä¿è­‰ä»–æœƒæ˜¯æœ€æ–°çš„ç‹€æ…‹ï¼Œè€Œ client state è™•ç†èµ·ä¾†ä¹Ÿç›¸å°ç°¡å–®ï¼›Server State å‰‡æ˜¯éœ€è¦ç¶“ééåŒæ­¥ç²å–çš„ stateï¼Œåƒæ˜¯ call API å¾—åˆ°çš„ dataï¼Œä½ ç„¡æ³•ä¿è­‰ä»–æ˜¯æœ€æ–°çš„ï¼Œä¸¦ä¸”å¸¸å¸¸éœ€è¦ç¶“éæ¯”è¼ƒè¤‡é›œçš„è™•ç†ï¼Œæ¯”å¦‚ cacheã€é‡æ–° fetchã€æŠ‘æˆ–æ˜¯ background updating ç­‰ç­‰çš„ï¼Œè€Œ React Query <strong>å°±æ˜¯ç‚ºäº†æ›´å¥½çš„è™•ç† Server State</strong> è€Œå‡ºç¾ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒReact Query å’Œ Redux ä¸æ˜¯äºŒé¸ä¸€çš„é¸é …ï¼Œè€Œæ˜¯å¯ä»¥å…±å­˜çš„ï¼Œå¦‚åŒä½œè€… Tanner Linsey åœ¨ <a target="_blank" rel="noopener" href="https://www.reddit.com/r/reactjs/comments/ds0hp4/react_query_hooks_for_fetching_caching_and/">reddit</a> æ‰€è¨€ï¼š</p>
<blockquote>
<p>React Query is significantly different from using Redux. Redux is a global state manager with itâ€™s own context etc. React Query to some extent is also a global state manager for async data. If you were to integrate the two, you would move all of your async data out of redux into React Query and only use Redux for non-async-data global application state.</p>
</blockquote>
<p>ä½œè€… Tanner Linsey èªªåˆ°ä»–åœ¨é–‹ç™¼ <a target="_blank" rel="noopener" href="https://nozzle.io/">Nozzle.io</a> çš„éæ¸¡æ™‚æœŸå°±æ˜¯æ¡ç”¨é€™æ¨£çš„æ–¹å¼ï¼Œè€Œåœ¨æœ€å¾Œ Redux ä¹Ÿè¢«æ‹”æ‰äº†ï¼Œè€Œæ˜¯æ”¹ç”¨ <code>useReducer</code> + React Context ä¾†ç®¡ç† global UI stateã€‚</p>
<p>å¦‚æœè¦ºå¾—åŸæœ¬çš„ Redux + Redux middleware ç”Ÿæ…‹ç³»ä½¿ç”¨çš„å¾ˆå¥½ï¼Œå°ˆæ¡ˆé‚è¼¯æ¶æ§‹è »æ¸…æ™°çš„ï¼Œä¹Ÿæœ‰å…¶ä»–æ–¹å¼è™•ç† cacheã€é‡æ–° fetch é€™é¡çš„äº‹æƒ…ï¼Œé‚£ä¸ä½¿ç”¨ç•¶ç„¶ä¹Ÿæ²’å•é¡Œï¼›ä¸é React Query æ˜¯ä¸€å€‹æ–°çš„é¸æ“‡ï¼Œè®“ä½ ç”¨ç°¡å–®çš„å¹¾å€‹ API  å°±èƒ½å¤ ç°¡å–®å°ä»˜éº»ç…©çš„ cache ä»¥åŠæ›´å¥½çš„ç®¡ç† Server Stateï¼Œå¦‚æœæœ‰èˆˆè¶£çš„è©±ï¼Œå¯ä»¥çµ¦å®ƒå€‹æ©Ÿæœƒè©¦è©¦ï¼ˆèˆ‡ React Query ç”¨é€”ç›¸ä¼¼çš„é‚„æœ‰ <a target="_blank" rel="noopener" href="https://github.com/vercel/swr">React SWR</a> ä»¥åŠ GraphQL çš„ <a target="_blank" rel="noopener" href="https://github.com/apollographql/apollo-client">Apollo Client</a>ï¼‰</p>
<p>å¦å¤–ï¼Œæœ‰èˆˆè¶£çš„è©±ä¹Ÿå¯ä»¥çœ‹çœ‹ä½œè€…çš„ <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=seU46c6Jz7E&feature=emb_title">å½±ç‰‡ä»‹ç´¹</a> ï¼Œé€™éƒ¨å½±ç‰‡æŠŠ React Query èª•ç”Ÿçš„ç›®çš„è¬›è§£éå¸¸æ¸…æ¥šï¼ŒåŒæ™‚ä¹Ÿç”¨äº† React Query é‡æ§‹å°å°ˆæ¡ˆï¼Œè®“é–‹ç™¼è€…å€‘èƒ½å¤ çœ‹çœ‹é‡æ§‹å‰å¾Œçš„å·®ç•°ï¼ˆé›–ç„¶æˆ‘è¦ºå¾—å½±ç‰‡ä¸­çš„è¢å¹•å¤ªå°äº†ï¼Œå¾ˆé›£çœ‹æ¸…æ¥š codeï¼‰</p>
<h2 id="ğŸ‘‰-Getting-Started"><a href="#ğŸ‘‰-Getting-Started" class="headerlink" title="ğŸ‘‰ Getting Started"></a>ğŸ‘‰ Getting Started</h2><p>æ¥ä¸‹ä¾†æƒ³ç”¨ <a target="_blank" rel="noopener" href="https://swapi.dev/">Star Wars API</a> å»ºç«‹çš„ç°¡å–® project ä¾†ä»‹ç´¹ React Query çš„å„å€‹ APIï¼Œé€™é‚Šæœ‰å»ºå¥½çš„ <a target="_blank" rel="noopener" href="https://codesandbox.io/s/blissful-poincare-vxqv8?file=/src/App.js">codesandbox template</a></p>
<h3 id="é–‹å§‹å‰çš„é ˆçŸ¥-React-Query-çš„é è¨­è¡Œç‚º"><a href="#é–‹å§‹å‰çš„é ˆçŸ¥-React-Query-çš„é è¨­è¡Œç‚º" class="headerlink" title="é–‹å§‹å‰çš„é ˆçŸ¥ - React Query çš„é è¨­è¡Œç‚º"></a>é–‹å§‹å‰çš„é ˆçŸ¥ - React Query çš„é è¨­è¡Œç‚º</h3><ol>
<li>Query results æ¸²æŸ“åœ¨ç•«é¢ä¸Šçš„çµæœæœƒåœ¨ä»–å€‘è¢« resolved å¾Œé¦¬ä¸ŠéæœŸï¼Œä¸¦ä¸”ç•¶çµæœå†æ¬¡è¢« render æˆ–æ˜¯è¢«ä½¿ç”¨æ™‚ï¼Œæœƒè‡ªå‹•åœ¨èƒŒæ™¯ refetchï¼Œä¸¦ä¸”é–‹ç™¼è€…ä¹Ÿå¯ä»¥æ”¹è®Š <code>staleTime</code> é€™å€‹è¨­å®šä¾†èª¿æ•´éæœŸçš„æ™‚é–“ï¼ˆé è¨­ç‚º <code>0</code> millisecondsï¼‰ã€‚</li>
<li>Query results åœ¨ Component unmounted å¾Œä»ç„¶æœƒè¢« cachedï¼Œgarbage collected é è¨­çš„æ™‚é–“ç‚ºäº”åˆ†é˜ï¼Œå‡å¦‚é€™äº”åˆ†é˜å†æ¬¡è¢«ä½¿ç”¨åˆ°çš„è©±ï¼Œå°±æœƒå¾ cached å–å‡ºé€™äº› results ä½¿ç”¨ï¼Œå¦‚æœè¦æ›´æ”¹é è¨­å€¼çš„è©±ï¼Œå¯ä»¥å¾ <code>cacheTime</code> ä¾†åšèª¿æ•´ï¼ˆé è¨­ç‚º <code>1000 * 60 * 5</code> millisecondsï¼‰ã€‚</li>
<li>Stale queries æœƒåœ¨ä½¿ç”¨è€… refocus ç€è¦½å™¨çš„ window æˆ–æ˜¯ç€è¦½å™¨é‡æ–°é€£ç·šæ™‚ refetchï¼Œå¦‚æœä¸æƒ³æœ‰é€™äº›è¡Œç‚ºçš„è©±ï¼Œä¹Ÿå¯ä»¥å¾ <code>refetchOnWindowFocus</code> å’Œ <code>refetchOnReconnect</code> é€™å…©å€‹é¸é …ä¾†åšèª¿æ•´</li>
<li>Queries å¦‚æœå¤±æ•—çš„è©±ï¼Œæœƒ retried ä¸‰æ¬¡ï¼Œç•¶ä¸‰æ¬¡éƒ½å¤±æ•—çš„æ™‚å€™ status æ‰æœƒé¡¯ç¤º errorï¼Œå¦‚æœè¦æ›´æ”¹é€™é¡è¨­å®šçš„è©±ï¼Œå¯ä»¥å¾ <code>retry</code> å’Œ <code>retryDelay</code> ä¾†èª¿æ•´ã€‚</li>
<li>Query results åœ¨é è¨­æƒ…æ³ä¸‹æœƒæ˜¯ structurally shared çš„ï¼Œä»¥æª¢æ¸¬ data æ˜¯å¦æœ‰æ›´æ”¹ï¼Œå¦‚æœæ²’æœ‰çš„è©±ï¼Œreferences å°±æœƒä¿æŒä¸è®Šï¼Œä»¥ä¿è­‰ <code>useCallback</code> å’Œ <code>useMemo</code> value çš„ç©©å®šã€‚structurally shared åªå° JSON-compatible values æœ‰ä½œç”¨ï¼Œå…¶ä»–çš„ value types éƒ½æœƒè¢«è¦–ç‚ºæœ‰è®ŠåŒ–çš„ï¼Œå¦‚æœä½ ç™¼ç¾æ•ˆèƒ½ä¸Šçš„å•é¡Œä¾†è‡ªæ–¼å¤ªé¾å¤§çš„ responseï¼Œä½ å¯ä»¥æŠŠ <code>config.structuralSharing</code> é€™å€‹é¸é …çµ¦ disabledï¼Œé‚£å¦‚æœä½ åœ¨è™•ç† non-JSON compatible values çš„è©±ï¼Œä»ç„¶æƒ³ç›£æ¸¬ data æ˜¯å¦æœ‰è®ŠåŒ–çš„è©±ï¼Œå¯ä»¥å¾ <code>config.isDataEqual</code> åšæ›´å®¢è£½åŒ–çš„è¨­å®šã€‚</li>
</ol>
<h3 id="useQuery"><a href="#useQuery" class="headerlink" title="useQuery"></a>useQuery</h3><p>é¦–å…ˆä»‹ç´¹ç¬¬ä¸€å€‹ APIï¼Œ<code>useQuery</code>ï¼Œç›®å‰æˆ‘å€‘æœ‰å¹¾å€‹ componentï¼Œ<code>App.jsx</code>ã€<code>Navbar.jsx</code>ã€<code>Planets.jsx</code> å’Œ <code>People.jsx</code> é€™å¹¾å€‹ Componentï¼Œæˆ‘å€‘çš„ä¸»è§’å°±æ˜¯ <code>Planets.jsx</code>ã€<code>People.jsx</code>ï¼Œå…¶ä»–ä¸é‡è¦ï¼Œ<code>Navbar.jsx</code> å°±æ˜¯ç”¨ä¾†åˆ‡æ› Planets å’Œ People ç”¨çš„å°è¦½åˆ—ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å…ˆåˆ° <code>Planets.jsx</code> é€™æ”¯æª”æ¡ˆï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ¯«ç„¡åæ‡‰ï¼Œå°±æ˜¯ä¸€æ”¯ç„¡èŠçš„ Componentï¼Œæ‰€ä»¥æˆ‘å€‘ä¾†è¨­å®šä¸€ä¸‹ç¾åœ¨çš„é¦–è¦ä»»å‹™ç›®æ¨™ï¼Œä»¥åŠé è¨ˆå¦‚ä½•åŸ·è¡Œï¼š</p>
<h4 id="â›³ï¸-ä»»å‹™ç›®æ¨™"><a href="#â›³ï¸-ä»»å‹™ç›®æ¨™" class="headerlink" title="â›³ï¸ ä»»å‹™ç›®æ¨™"></a>â›³ï¸ ä»»å‹™ç›®æ¨™</h4><p>ç™¼ request å¾ <code>&#39;https://swapi.dev/api/planets/&#39;</code> é€™å€‹ endpoint å–å¾— response å¾Œï¼ŒæŠŠå„å€‹æ˜Ÿçƒçš„è³‡æ–™ render åˆ°ç•«é¢ä¸Šã€‚</p>
<h4 id="â›³ï¸-å¦‚ä½•åŸ·è¡Œ"><a href="#â›³ï¸-å¦‚ä½•åŸ·è¡Œ" class="headerlink" title="â›³ï¸ å¦‚ä½•åŸ·è¡Œ"></a>â›³ï¸ å¦‚ä½•åŸ·è¡Œ</h4><p>ä½¿ç”¨ <code>fetch</code> å’Œ <code>useQuery</code> é”æˆä»»å‹™ï¼</p>
<p>æ¥è‘—æˆ‘å€‘å°±é–‹å§‹å§ï¼Œé¦–å…ˆï¼ŒuseQuery ä½¿ç”¨ä¸Šçš„åƒæ•¸æœ‰å…©å€‹ï¼š</p>
<blockquote>
<ul>
<li>A <strong>unique key for the query</strong></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>An <strong>asynchronous function (or similar then-able)</strong> to resolve the data</li>
</ul>
</blockquote>
<p>ç¬¬ä¸€å€‹åƒæ•¸å¿…é ˆæ˜¯ä¸€å€‹ unique çš„ keyï¼Œé€™å€‹ key å¯ä»¥æ˜¯å­—ä¸²ã€é™£åˆ—ã€æˆ–æ˜¯ç‰©ä»¶ï¼Œé€™é‚Šç‚ºäº†ç°¡å–®èµ·è¦‹ï¼Œå°±å…ˆéš¨ä¾¿ç”¨å€‹å­—ä¸² <code>planets</code>ï¼›ç¬¬äºŒå€‹åƒæ•¸å‰‡æ˜¯ fetch data æ™‚æœƒç”¨åˆ°çš„éåŒæ­¥ functionï¼Œé€™å€‹ function å°±æ˜¯å¹³å¸¸ä½ åœ¨ fetch data æ™‚æœƒå¯«çš„ functionï¼Œæ‰€ä»¥æˆ‘å€‘å°±å…ˆå¯«æˆé€™æ¨£ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> status<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token string">'planets'</span><span class="token punctuation">,</span>
    fetchPlanets
  <span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> status<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¾ˆç°¡å–®ï¼Œå°±æ˜¯å…ˆå¯«å€‹ asynchronous functionï¼Œç„¶å¾ŒæŠŠ asynchronous function ç•¶ä½œåƒæ•¸å‚³å…¥é€™æ¨£ã€‚</p>
<p>æ¥ä¸‹ä¾†ï¼Œè¬›è§£ä¸€ä¸‹ useQuery åŸ·è¡Œå¾Œæœƒå›å‚³çš„å…§å®¹ï¼š</p>
<blockquote>
<p>dataï¼šå°±æ˜¯ fetch å¾Œæœƒå¾—åˆ°çš„ response</p>
<p>statusï¼šåˆ†æˆä¸‰å€‹é¡å‹çš„å­—ä¸²ï¼Œ<code>loading</code>ã€<code>success</code>ã€<code>error</code>ï¼Œå°±æ˜¯ä¸€èˆ¬æˆ‘å€‘åœ¨ fetch æ™‚æœƒæœ‰çš„ä¸‰ç¨®ç‹€æ…‹</p>
<p>isLoadingã€isSuccessã€isErrorï¼šå¦‚æœä¸å–œæ­¡ status çš„ç”¨æ³•çš„è©±ï¼Œå¯ä»¥æ”¹ç”¨é€™äº› flag</p>
</blockquote>
<p>å› ç‚ºæˆ‘æ¯”è¼ƒç¿’æ…£ <code>isXXX</code> é€™é¡çš„ flag ç”¨æ³•ï¼Œåœ¨å¾—åˆ° data ä¹‹å¾Œæˆ‘å€‘å¯ä»¥å¯«æˆé€™æ¨£ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token string">'planets'</span><span class="token punctuation">,</span>
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å™¹å•·ï¼ä»»å‹™ç›®æ¨™ç°¡æ½”ä¸”å„ªé›…åœ°å®Œæˆäº†ï¼é€™é‚Šæ–°å¢çš„ Planet Component å…§å®¹é•·é€™æ¨£ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planet</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> planet <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">population: </span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>population<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">terrain : </span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>terrain<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å†ç¨å¾®èª¿æ•´ css å¾Œç•«é¢æœƒé€™æ¨£ï¼š</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg" alt="æˆªåœ– 2020-09-05 ä¸‹åˆ3.29.43"></p>
<p>ç•«é¢å¾ˆé†œæˆ‘çŸ¥é“ï¼Œä½†æˆ‘ç›¡åŠ›äº†ï¼Œç„¶å¾Œ <code>People.jsx</code> è¦åšçš„äº‹æƒ…æ˜¯å·®ä¸å¤šçš„ï¼Œæ‰€ä»¥å°±ä¸å¤šè´…è¿°ï¼Œé€™æ˜¯å®Œæˆå¾Œçš„ <a target="_blank" rel="noopener" href="https://codesandbox.io/s/blissful-poincare-vxqv8?file=/src/App.js">codesandbox</a>ã€‚</p>
<h4 id="æ‰€ä»¥â€¦å’Œ-useFetch-Hook-å·®åœ¨å“ªå‘¢ï¼Ÿ"><a href="#æ‰€ä»¥â€¦å’Œ-useFetch-Hook-å·®åœ¨å“ªå‘¢ï¼Ÿ" class="headerlink" title="æ‰€ä»¥â€¦å’Œ useFetch Hook å·®åœ¨å“ªå‘¢ï¼Ÿ"></a>æ‰€ä»¥â€¦å’Œ useFetch Hook å·®åœ¨å“ªå‘¢ï¼Ÿ</h4><p>ç¾åœ¨ React Hook ä¹Ÿæœ‰äººä½œå‡ºäº†å„ç¨® fetch data ç›¸é—œçš„ custom hookï¼Œ<code>useQuery</code> ç”¨èµ·ä¾†å…¶å¯¦å¤§åŒå°ç•°ï¼Œä½†æœ€å¤§çš„å·®åˆ¥æ˜¯åœ¨æ–¼å®ƒèƒŒå¾Œå¹«ä½ è™•ç†äº† cacheã€dedupingã€updating  out of date data in the background ç­‰å„ç¨®äº‹æƒ…ã€‚</p>
<p>æ‰€ä»¥ä½ æœƒç™¼ç¾åˆ°ç¬¬ä¸€æ¬¡ fetch çš„æ™‚å€™æœƒé¡¯ç¤ºçŸ­æš«çš„ loading ç•«é¢ï¼Œä½†ä¹‹å¾Œåœ¨ã€ŒPlanetã€å’Œã€ŒPeopleã€åˆ‡æ›å°±é †æš¢ç„¡æ¯”ï¼Œå› ç‚º data éƒ½å¾ cached ä¸­å–å¾—ã€‚</p>
<h3 id="React-Query-DevTool"><a href="#React-Query-DevTool" class="headerlink" title="React Query DevTool"></a>React Query DevTool</h3><p>React Query é‚„æœ‰è²¼å¿ƒçš„æä¾› Devtool æä¾›é–‹ç™¼è€…è©³ç´°çš„æª¢è¦–æ¯å€‹ query åŸ·è¡Œçš„ç‹€æ…‹ï¼Œä½¿ç”¨ä¸Šä¹Ÿå¾ˆç°¡å–®ï¼Œé¦–å…ˆå®‰è£ react query devtools</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> react-query-devtools<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  æ¥ä¸‹ä¾†åœ¨ App.jsx import é€²ä¾†ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ReactQueryDevtools <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query-devtools'</span> <span class="token comment">// é€™è¡Œ</span>
<span class="token keyword">import</span> Navbar <span class="token keyword">from</span> <span class="token string">'./components/Navbar'</span>
<span class="token keyword">import</span> Planets <span class="token keyword">from</span> <span class="token string">'./components/Planets'</span>
<span class="token keyword">import</span> People <span class="token keyword">from</span> <span class="token string">'./components/People'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'planets'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Star Wars Info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navbar</span></span> <span class="token attr-name">setPage</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>setPage<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>page <span class="token operator">===</span> <span class="token string">'planets'</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planets</span></span> <span class="token punctuation">/></span></span> <span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">People</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactQueryDevtools</span></span> <span class="token attr-name">initialIsOpen</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token boolean">false</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"> // ä»¥åŠé€™è¡Œï¼ŒinitialIsOpen å°±æ˜¯è¨­å®šæ˜¯å¦é è¨­ç‚ºæ‰“é–‹çš„ç‹€æ…‹
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ‰“é–‹ç›®å‰ localhost çš„é é¢å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•«é¢ï¼š</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giha9kf5brj31gi0u0tgv.jpg" alt="æˆªåœ– 2020-09-06 ä¸‹åˆ10.07.38"></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒæä¾›äº† Dataã€Query çš„è©³ç´°è¨­å®šã€ç›®å‰ Data æ˜¯ freshã€fetchingã€inactive ç­‰ç­‰ï¼Œå¦‚æœç™¼é€äº†ä¸åŒçš„ queryï¼Œä¹Ÿæœƒé¡¯ç¤ºæ¯å€‹ query çš„ç‹€æ…‹ï¼š</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihabcdeeej31gi0u0gtl.jpg" alt="æˆªåœ– 2020-09-06 ä¸‹åˆ10.09.06"></p>
<p>ç”¨èµ·ä¾†è »åƒ Redux Devtools çš„ï¼è¨­å®šä¹Ÿè¶…ç´šç°¡å–®ï¼Œå®‰è£å¾Œ import é€²ä¾†å°±å¥½ï¼Œä»‹é¢æ›´æ˜¯ç°¡æ½”ç›´è§€ã€‚</p>
<h3 id="å¦‚æœæƒ³è¦åˆ†é æ€éº¼åšï¼ŸusePaginationï¼"><a href="#å¦‚æœæƒ³è¦åˆ†é æ€éº¼åšï¼ŸusePaginationï¼" class="headerlink" title="å¦‚æœæƒ³è¦åˆ†é æ€éº¼åšï¼ŸusePaginationï¼"></a>å¦‚æœæƒ³è¦åˆ†é æ€éº¼åšï¼ŸusePaginationï¼</h3><h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>å‰é¢æœ‰å¾ˆå¿«é€Ÿçš„æåˆ°ï¼Œkey å¯ä»¥æä¾› stringsã€arrayã€object ç­‰å‹æ…‹ï¼Œç•¶æˆ‘å€‘é‡åˆ°æ¯”è¼ƒè¤‡é›œçš„æ‡‰ç”¨å ´æ™¯æ™‚ï¼Œå°±å¯ä»¥è©¦è‘—ç”¨ array æˆ– object ä¾†æ‡‰ä»˜é€™äº›æƒ…å½¢ï¼Œä¸‹é¢å°±ä»¥åˆ†é åšç¯„ä¾‹ã€‚</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token comment">// output: 1</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// å‚³å…¥é™£åˆ— </span>
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç•¶æˆ‘å€‘æŠŠ useQuery çš„ç¬¬ä¸€å€‹åƒæ•¸ key æ”¹ä»¥é™£åˆ—å‚³å…¥æ™‚ï¼Œasynchronous function çš„åƒæ•¸å€¼å°±æœƒä¾ç…§é™£åˆ—çš„é †åºå‚³å…¥å€¼ï¼Œä»¥ä¸Šé¢ <code>fetchPlanets</code> çš„ä¾‹å­ä¾†èªªï¼Œå®ƒçš„ç¬¬ä¸€å€‹ parameter çš„å€¼å°±æœƒæ˜¯ <code>plaents</code>ï¼Œç¬¬äºŒå€‹ parameter å‰‡æ˜¯ <code>page</code> ï¼Œä¹Ÿå› ç‚ºå¦‚æ­¤ï¼Œæˆ‘å€‘å¤šäº†æ›´å¤šå½ˆæ€§ä½¿ç”¨çš„ç©ºé–“ã€‚</p>
<p>èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥é–‹å§‹ä½œåˆ†é äº†ï¼</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.dev/api/planets/?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// æ–°å¢äº† page parameter</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// æ–°å¢ page state</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">,</span> 
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> // å¢åŠ ä¸€å † button æ”¹è®Š page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç•«é¢æœƒé•·é€™æ¨£ï¼š</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihbw2bgddg30nw0hghdt.gif" alt="Sep-06-2020 23-04-08"></p>
<p>ä¸Šé¢åšçš„æ”¹å‹•å¾ˆç°¡å–®ï¼Œendpoint æ–°å¢ page parameterã€page state ä»¥åŠå¢åŠ æ”¹è®Š page çš„ buttonï¼Œä½†å•é¡Œä¹Ÿå¾ˆé¡¯è€Œæ˜“è¦‹ï¼š</p>
<ol>
<li>é€™æ¨£æ–°å¢ button åŒ—ä¸ƒåŒ—ä¸ƒçš„ï¼ˆä½†é€™å–®ç´”æ˜¯æˆ‘æ‡¶ï¼‰</li>
<li>åˆ‡æ›åˆ†é çš„æ™‚å€™ï¼Œæœƒä¸åœé¡¯ç¤º loadingï¼Œé™¤é fetch éä¸€æ¬¡ï¼Œæ‰æœƒç›´æ¥æŠ“ cache çš„ data è€Œä¸é¡¯ç¤º loading</li>
</ol>
<p>ä¸åœåˆ‡æ› loading å’Œæ–°é é¢ï¼Œé›–ç„¶ä¸€èˆ¬ä¾†èªªæ˜¯èƒ½å¤ å®¹å¿çš„ï¼Œä½† UX ä¼¼ä¹å¯ä»¥æ›´å¥½ï¼Œç‚ºäº†å¢é€² UXï¼Œæ¥ä¸‹ä¾†è¦ä½¿ç”¨ React Query æä¾›çš„å¦ä¸€å€‹ APIï¼Œå°±æ˜¯ usePaginatedQueryï¼</p>
<h3 id="usePaginatedQuery"><a href="#usePaginatedQuery" class="headerlink" title="usePaginatedQuery"></a>usePaginatedQuery</h3><p>å‰é¢ä½¿ç”¨ <code>useQuery</code> å¯ä»¥ç™¼ç¾åˆ°å®ƒé‹ä½œä¸Šæ²’ä»€éº¼å•é¡Œï¼Œå¾ˆå¤šçš„ Web App ä¹Ÿæ˜¯é€™æ¨£é‹ä½œçš„ï¼Œä½†ç¾ä¸­ä¸è¶³çš„åœ°æ–¹æ˜¯ UI æœƒä¸€ç›´åœ¨ <code>success</code> å’Œ <code>loading</code> ä¹‹é–“åˆ‡æ›ï¼Œä¸éå¦‚æœä½¿ç”¨ <code>usePaginatedQuery</code>ï¼Œå‰‡æœ‰å¹¾å€‹ä¸åŒçš„åœ°æ–¹ï¼š</p>
<ul>
<li><code>usePaginatedQuery</code> ä¸ä½¿ç”¨ <code>data</code>ï¼Œè€Œæ˜¯æ”¹æˆ <code>resolvedData</code>ã€‚<code>resolvedData</code> æ˜¯æœƒæ˜¯ä¸Šä¸€æ¬¡æˆåŠŸ fetch çš„ query resultï¼Œç•¶ä½ ç™¼é€æ–°åˆ†é çš„ request æ™‚ï¼Œ<code>resolvedData</code> ç›´åˆ°æˆåŠŸ fetch å‰éƒ½æœƒä¿æŒåŸæœ¬çš„ dataï¼Œfetch æˆåŠŸä¸¦æ‹¿åˆ°æ–°çš„ data å¾Œï¼Œ<code>resolvedData</code> æ‰æœƒè®Šæˆæœ€æ–°çš„ dataã€‚</li>
<li>å¦‚æœçœŸçš„éœ€è¦ç™¼é€ request çš„ç•¶ä¸‹å°±è¦æ‹¿åˆ° dataï¼Œå¯ä»¥ä½¿ç”¨ <code>latestData</code> ï¼Œç•¶ä½ ç™¼é€ request åˆ°è¢« resolved å‰ï¼Œ<code>latestData</code> æœƒæ˜¯ <code>undefined</code> ç›´åˆ° query resolvedï¼Œæ‰€ä»¥é‹ä½œæ–¹å¼å°±è »åƒåŸæœ¬ <code>useQuery</code> çš„ <code>data</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘å€‘æŠŠåŸæœ¬ code æ”¹å‹•ä¸€ä¸‹ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> usePaginatedQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.dev/api/planets/?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
    resolvedData<span class="token punctuation">,</span>
    latestData<span class="token punctuation">,</span>
    isLoading<span class="token punctuation">,</span>
    isError<span class="token punctuation">,</span>
    isSuccess<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">usePaginatedQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">,</span> fetchPlanets<span class="token punctuation">)</span> <span class="token comment">// å¾ useQuery æ”¹æˆä½¿ç”¨ usePaginatedQuery</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevPage</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>prevPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> // ä¿®æ”¹ä¸€ä¸‹ button
        Previous Page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>page<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevPage</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token operator">!</span>latestData <span class="token operator">||</span> <span class="token operator">!</span>latestData<span class="token punctuation">.</span>next <span class="token operator">?</span> prevPage <span class="token operator">:</span> prevPage <span class="token operator">+</span> <span class="token number">1</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">
        Next Page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        resolvedData<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é™„è¨»ä¸€ä¸‹ï¼Œé€™é‚Š Previous Page Button ä½¿ç”¨ <code>Math.max</code> çš„ç›®çš„æ˜¯é¿å…åœ¨ç¬¬ä¸€é çš„æ™‚å€™æœƒè¢«æŒçºŒæ‰£æ¸›åˆ°å°æ–¼ 1ã€‚</p>
<p>é€™æ™‚å€™æ“ä½œä¸Šæœƒè®Šå¾—åƒæ˜¯é€™æ¨£ï¼š</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihczyiibeg30nw0hgqv5.gif" alt="Sep-06-2020 23-42-42"></p>
<p>å¥½ï¼Œæ”¹å®Œä¹‹å¾Œæˆ‘è¦ºå¾— UX æœ‰æ²’æœ‰è®Šå¥½å‘¢ï¼Ÿâ€¦æˆ‘ä¿æŒæ‡·ç–‘çš„æ…‹åº¦ï¼ŒåŸå› æ˜¯åŸæœ¬ UI çš„ç¢ºæ˜¯æœƒåœ¨ loading å’Œå®Œæ•´çš„ç•«é¢åˆ‡æ›ï¼ˆå¦‚æœè¦æœ‰æ›´å¥½çš„ UX æ‡‰è©²æœƒæ˜¯ç”¨ Skeletonï¼‰ï¼›è€Œæ”¹ç”¨ <code>usePaginatedQuery</code> å¾Œï¼Œåœ¨ data å®Œæˆå‰ï¼Œç•«é¢éƒ½æœƒä¿æŒåŸæ¨£ï¼Œæ‰€ä»¥ä½¿ç”¨è€…ä¹Ÿå¯èƒ½æœƒæ‡·ç–‘è‡ªå·±çš„æ“ä½œåˆ°åº•æœ‰æ²’æœ‰æˆåŠŸï¼Œæœ‰ loading çš„è©±è‡³å°‘é‚„èƒ½çŸ¥é“è‡ªå·±æ“ä½œæœ‰æˆåŠŸï¼Œåªæ˜¯éœ€è¦ç­‰å¾…ã€‚</p>
<h2 id="ğŸ‘‰-çµèª"><a href="#ğŸ‘‰-çµèª" class="headerlink" title="ğŸ‘‰ çµèª"></a>ğŸ‘‰ çµèª</h2><p>å¦‚åŒæ¨™é¡Œæ‰€è¨€ï¼Œé€™ç¯‡å°±æ˜¯ Tutorialï¼Œä»‹ç´¹æœ€åŸºæœ¬çš„ API å’Œä½¿ç”¨æ–¹å¼ï¼Œä½†é‚„æœ‰å¾ˆå¤šåœ°æ–¹æ²’æåŠï¼Œæ¯”å¦‚æ›´è©³ç´°çš„å®˜æ–¹æ–‡ä»¶å…§å®¹ã€<code>useMutation</code>ã€React Query çš„ cache æ€éº¼é‹ä½œç­‰ç­‰ã€‚</p>
<h3 id="å¾…ç ”ç©¶çš„å•é¡Œ"><a href="#å¾…ç ”ç©¶çš„å•é¡Œ" class="headerlink" title="å¾…ç ”ç©¶çš„å•é¡Œ"></a>å¾…ç ”ç©¶çš„å•é¡Œ</h3><ul>
<li>useMuation ä»¥åŠå®˜æ–¹æ–‡ä»¶æ›´è©³ç´°çš„å…§å®¹</li>
<li>data æœƒ cache åœ¨å“ªè£¡ï¼Ÿ</li>
<li>å¦‚æœè¨­å®šä¸€å€‹ staleTIme å¾Œï¼Œåœ¨éæœŸä»¥å‰å¦‚æœè³‡æ–™æ›´æ–°ï¼ŒReact Query æœƒæ€éº¼åšï¼Ÿ</li>
<li>å¦‚æœè¦å…±ç”¨ä¸€ä»½ dataï¼Œåªèƒ½ç”¨ custom hook å—ï¼Ÿé‚£å‡å¦‚æœ‰ Component A å’Œ Bï¼Œéƒ½è¦ç”¨åŒä¸€ä»½ dataï¼Œæ˜¯å¦åªèƒ½ call å…©æ¬¡ API å‘¢ï¼Ÿå¦‚æœä¸æƒ³ call å…©æ¬¡ APIï¼Œé‚£æ˜¯ä¸æ˜¯åªèƒ½æ”¾é€² Redux æˆ– Context çš„ Global State å‘¢ï¼Ÿ</li>
</ul>
<p>é€™äº›å•é¡Œæ—¥å¾Œå°±ä¾†ç ”ç©¶ã€‚</p>
<h2 id="ğŸ‘‰-Refercences"><a href="#ğŸ‘‰-Refercences" class="headerlink" title="ğŸ‘‰ Refercences"></a>ğŸ‘‰ Refercences</h2><p><a target="_blank" rel="noopener" href="https://react-query.tanstack.com/docs/overview">React Query Docs</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=x1rQ61otgtU&list=PL4cUxeGkcC9jpi7Ptjl5b50p9gLjOFani&index=1">The Net Ninjia - React Query Tutorial</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Front-End/" rel="tag"># Front-End</a>
              <a href="/tags/React/" rel="tag"># React</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/27/VSCode-Auto-Organize-Import/" rel="prev" title="VSCode è‡ªå‹•åˆªé™¤æ²’å±ç”¨ import ä»¥åŠæ’ç‰ˆ">
                  <i class="fa fa-chevron-left"></i> VSCode è‡ªå‹•åˆªé™¤æ²’å±ç”¨ import ä»¥åŠæ’ç‰ˆ
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/11/14/react-query-and-swr-cache-strategy/" rel="next" title="React Queryã€SWR çš„ cache strategy & æ·ºè«‡ source code">
                  React Queryã€SWR çš„ cache strategy & æ·ºè«‡ source code <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chih Yang</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  





<script>
NexT.utils.loadComments('.utterances-container', () => {
  const script = document.createElement('script');
  script.src = 'https://utteranc.es/client.js';
  script.setAttribute('repo', "ChihYang41/ChihYang41.github.io");
  script.setAttribute('issue-term', "title");
  script.setAttribute('theme', "github-light");
  script.crossOrigin = 'anonymous';
  script.async = true;
  document.querySelector('.utterances-container').appendChild(script);
});
</script>

</body>
</html>

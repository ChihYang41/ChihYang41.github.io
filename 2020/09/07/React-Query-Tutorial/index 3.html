<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="pdI9OcgtLe0I27rizFD2U3s553wFM8nsth5viFyCbOk">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chihyang41.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="前言data fetching 在 React 裡一直是我感到不太自在的一塊，主要是來自於我學藝不精，我知道 React 已經有部分的 pattern 在處理這一塊了，目前最常用到的就是 Redux + Redux middlewares（Redux thunk、Redux saga 等等），前陣子則是開始試著用 custom hook 來處理這塊，感覺很不賴，但比如 cache 等等的事情依然麻">
<meta property="og:type" content="article">
<meta property="og:title" content="React Query Tutorial">
<meta property="og:url" content="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/index.html">
<meta property="og:site_name" content="Chih Yang&#39;s Blog">
<meta property="og:description" content="前言data fetching 在 React 裡一直是我感到不太自在的一塊，主要是來自於我學藝不精，我知道 React 已經有部分的 pattern 在處理這一塊了，目前最常用到的就是 Redux + Redux middlewares（Redux thunk、Redux saga 等等），前陣子則是開始試著用 custom hook 來處理這塊，感覺很不賴，但比如 cache 等等的事情依然麻">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1giha9kf5brj31gi0u0tgv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihabcdeeej31gi0u0gtl.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihbw2bgddg30nw0hghdt.gif">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihczyiibeg30nw0hgqv5.gif">
<meta property="article:published_time" content="2020-09-06T16:34:24.000Z">
<meta property="article:modified_time" content="2020-09-06T16:34:24.000Z">
<meta property="article:author" content="Chih Yang">
<meta property="article:tag" content="Front-End">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg">


<link rel="canonical" href="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>React Query Tutorial | Chih Yang's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146838618-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-146838618-1');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/images/logo.png" alt="Chih Yang's Blog">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chih Yang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-%E7%82%BA%E4%BD%95%E8%A6%81%E4%BD%BF%E7%94%A8%EF%BC%9F%E5%A6%82%E6%9E%9C%E4%B8%8D%E7%94%A8%E5%AE%83%E6%9C%83%E6%80%8E%E9%BA%BC%E6%A8%A3%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">👉 為何要使用？如果不用它會怎麼樣？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-Getting-Started"><span class="nav-number">3.</span> <span class="nav-text">👉 Getting Started</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%96%8B%E5%A7%8B%E5%89%8D%E7%9A%84%E9%A0%88%E7%9F%A5-React-Query-%E7%9A%84%E9%A0%90%E8%A8%AD%E8%A1%8C%E7%82%BA"><span class="nav-number">3.1.</span> <span class="nav-text">開始前的須知 - React Query 的預設行為</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useQuery"><span class="nav-number">3.2.</span> <span class="nav-text">useQuery</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9B%B3%EF%B8%8F-%E4%BB%BB%E5%8B%99%E7%9B%AE%E6%A8%99"><span class="nav-number">3.2.1.</span> <span class="nav-text">⛳️ 任務目標</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9B%B3%EF%B8%8F-%E5%A6%82%E4%BD%95%E5%9F%B7%E8%A1%8C"><span class="nav-number">3.2.2.</span> <span class="nav-text">⛳️ 如何執行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%80%E4%BB%A5%E2%80%A6%E5%92%8C-useFetch-Hook-%E5%B7%AE%E5%9C%A8%E5%93%AA%E5%91%A2%EF%BC%9F"><span class="nav-number">3.2.3.</span> <span class="nav-text">所以…和 useFetch Hook 差在哪呢？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Query-DevTool"><span class="nav-number">3.3.</span> <span class="nav-text">React Query DevTool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E5%88%86%E9%A0%81%E6%80%8E%E9%BA%BC%E5%81%9A%EF%BC%9FusePagination%EF%BC%81"><span class="nav-number">3.4.</span> <span class="nav-text">如果想要分頁怎麼做？usePagination！</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#key"><span class="nav-number">3.4.1.</span> <span class="nav-text">key</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#usePaginatedQuery"><span class="nav-number">3.5.</span> <span class="nav-text">usePaginatedQuery</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-%E7%B5%90%E8%AA%9E"><span class="nav-number">4.</span> <span class="nav-text">👉 結語</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%85%E7%A0%94%E7%A9%B6%E7%9A%84%E5%95%8F%E9%A1%8C"><span class="nav-number">4.1.</span> <span class="nav-text">待研究的問題</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%91%89-Refercences"><span class="nav-number">5.</span> <span class="nav-text">👉 Refercences</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chih Yang</p>
  <div class="site-description" itemprop="description">Chih Yang 的前端小天地</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ChihYang41" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ChihYang41" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/chihyang41" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;chihyang41" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ChihYang41" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://chihyang41.github.io/2020/09/07/React-Query-Tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chih Yang">
      <meta itemprop="description" content="Chih Yang 的前端小天地">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chih Yang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React Query Tutorial
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-07 00:34:24" itemprop="dateCreated datePublished" datetime="2020-09-07T00:34:24+08:00">2020-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/frontend/" itemprop="url" rel="index"><span itemprop="name">frontend</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>data fetching 在 React 裡一直是我感到不太自在的一塊，主要是來自於我學藝不精，我知道 React 已經有部分的 pattern 在處理這一塊了，目前最常用到的就是 Redux + Redux middlewares（Redux thunk、Redux saga 等等），前陣子則是開始試著用 custom hook 來處理這塊，感覺很不賴，但比如 cache 等等的事情依然麻煩，所以我在尋找有沒有更好的作法。</p>
<p>最近看到了 React Query，使用起來覺得很讚讚，文件說明清楚、API 少少的很簡單，很符合我心目中好用的 data fetching hook，不過目前也沒有用很深，更多的坑或是應用場景還沒有遇到，所以使用心得可能還要再一陣子才會有，這篇的目的就是做做筆記，提供日後的自己回顧。</p>
<span id="more"></span>

<h2 id="👉-為何要使用？如果不用它會怎麼樣？"><a href="#👉-為何要使用？如果不用它會怎麼樣？" class="headerlink" title="👉 為何要使用？如果不用它會怎麼樣？"></a>👉 為何要使用？如果不用它會怎麼樣？</h2><p>如果使用 Redux 一段時間後，應該會發現 Global State 大致上可以分成兩種類型，一種是關於整個 Web App 的內部狀態，比如 toggle、alert，這類狀態不需要 cache，又或是其他的處理；另一種則是需要經過非同步獲取的資料，像是 call API 才能拿到的 data、登入的 token 等等。</p>
<p>原本 Redux 的社群為了處理這類非同步的 state，誕生了像是 redux-thunk、redux-saga、redux-observable 等 middlewares 來處理相關邏輯，為的是讓邏輯分工更為明確，掌管 View 的 Component 就負責顯示畫面，call API 邏輯就在 middlewares 中處理，但時間一久你還是會發現 reducers 中分散了各類的 state，也就是同步的 state 和非同步的 state 混雜再一起。</p>
<p>React Query 就是因應而生的，作者將 global state 區分為 Client state 和 Server State，Client state 就是前面段落說的 Web App 內部狀態，你可以保證他會是最新的狀態，而 client state 處理起來也相對簡單；Server State 則是需要經過非同步獲取的 state，像是 call API 得到的 data，你無法保證他是最新的，並且常常需要經過比較複雜的處理，比如 cache、重新 fetch、抑或是 background updating 等等的，而 React Query <strong>就是為了更好的處理 Server State</strong> 而出現。</p>
<p>值得注意的是，React Query 和 Redux 不是二選一的選項，而是可以共存的，如同作者 Tanner Linsey 在 <a target="_blank" rel="noopener" href="https://www.reddit.com/r/reactjs/comments/ds0hp4/react_query_hooks_for_fetching_caching_and/">reddit</a> 所言：</p>
<blockquote>
<p>React Query is significantly different from using Redux. Redux is a global state manager with it’s own context etc. React Query to some extent is also a global state manager for async data. If you were to integrate the two, you would move all of your async data out of redux into React Query and only use Redux for non-async-data global application state.</p>
</blockquote>
<p>作者 Tanner Linsey 說到他在開發 <a target="_blank" rel="noopener" href="https://nozzle.io/">Nozzle.io</a> 的過渡時期就是採用這樣的方式，而在最後 Redux 也被拔掉了，而是改用 <code>useReducer</code> + React Context 來管理 global UI state。</p>
<p>如果覺得原本的 Redux + Redux middleware 生態系使用的很好，專案邏輯架構蠻清晰的，也有其他方式處理 cache、重新 fetch 這類的事情，那不使用當然也沒問題；不過 React Query 是一個新的選擇，讓你用簡單的幾個 API  就能夠簡單對付麻煩的 cache 以及更好的管理 Server State，如果有興趣的話，可以給它個機會試試（與 React Query 用途相似的還有 <a target="_blank" rel="noopener" href="https://github.com/vercel/swr">React SWR</a> 以及 GraphQL 的 <a target="_blank" rel="noopener" href="https://github.com/apollographql/apollo-client">Apollo Client</a>）</p>
<p>另外，有興趣的話也可以看看作者的 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=seU46c6Jz7E&feature=emb_title">影片介紹</a> ，這部影片把 React Query 誕生的目的講解非常清楚，同時也用了 React Query 重構小專案，讓開發者們能夠看看重構前後的差異（雖然我覺得影片中的螢幕太小了，很難看清楚 code）</p>
<h2 id="👉-Getting-Started"><a href="#👉-Getting-Started" class="headerlink" title="👉 Getting Started"></a>👉 Getting Started</h2><p>接下來想用 <a target="_blank" rel="noopener" href="https://swapi.dev/">Star Wars API</a> 建立的簡單 project 來介紹 React Query 的各個 API，這邊有建好的 <a target="_blank" rel="noopener" href="https://codesandbox.io/s/blissful-poincare-vxqv8?file=/src/App.js">codesandbox template</a></p>
<h3 id="開始前的須知-React-Query-的預設行為"><a href="#開始前的須知-React-Query-的預設行為" class="headerlink" title="開始前的須知 - React Query 的預設行為"></a>開始前的須知 - React Query 的預設行為</h3><ol>
<li>Query results 渲染在畫面上的結果會在他們被 resolved 後馬上過期，並且當結果再次被 render 或是被使用時，會自動在背景 refetch，並且開發者也可以改變 <code>staleTime</code> 這個設定來調整過期的時間（預設為 <code>0</code> milliseconds）。</li>
<li>Query results 在 Component unmounted 後仍然會被 cached，garbage collected 預設的時間為五分鐘，假如這五分鐘再次被使用到的話，就會從 cached 取出這些 results 使用，如果要更改預設值的話，可以從 <code>cacheTime</code> 來做調整（預設為 <code>1000 * 60 * 5</code> milliseconds）。</li>
<li>Stale queries 會在使用者 refocus 瀏覽器的 window 或是瀏覽器重新連線時 refetch，如果不想有這些行為的話，也可以從 <code>refetchOnWindowFocus</code> 和 <code>refetchOnReconnect</code> 這兩個選項來做調整</li>
<li>Queries 如果失敗的話，會 retried 三次，當三次都失敗的時候 status 才會顯示 error，如果要更改這類設定的話，可以從 <code>retry</code> 和 <code>retryDelay</code> 來調整。</li>
<li>Query results 在預設情況下會是 structurally shared 的，以檢測 data 是否有更改，如果沒有的話，references 就會保持不變，以保證 <code>useCallback</code> 和 <code>useMemo</code> value 的穩定。structurally shared 只對 JSON-compatible values 有作用，其他的 value types 都會被視為有變化的，如果你發現效能上的問題來自於太龐大的 response，你可以把 <code>config.structuralSharing</code> 這個選項給 disabled，那如果你在處理 non-JSON compatible values 的話，仍然想監測 data 是否有變化的話，可以從 <code>config.isDataEqual</code> 做更客製化的設定。</li>
</ol>
<h3 id="useQuery"><a href="#useQuery" class="headerlink" title="useQuery"></a>useQuery</h3><p>首先介紹第一個 API，<code>useQuery</code>，目前我們有幾個 component，<code>App.jsx</code>、<code>Navbar.jsx</code>、<code>Planets.jsx</code> 和 <code>People.jsx</code> 這幾個 Component，我們的主角就是 <code>Planets.jsx</code>、<code>People.jsx</code>，其他不重要，<code>Navbar.jsx</code> 就是用來切換 Planets 和 People 用的導覽列。</p>
<p>接下來，我們先到 <code>Planets.jsx</code> 這支檔案，可以看到以下：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>毫無反應，就是一支無聊的 Component，所以我們來設定一下現在的首要任務目標，以及預計如何執行：</p>
<h4 id="⛳️-任務目標"><a href="#⛳️-任務目標" class="headerlink" title="⛳️ 任務目標"></a>⛳️ 任務目標</h4><p>發 request 從 <code>&#39;https://swapi.dev/api/planets/&#39;</code> 這個 endpoint 取得 response 後，把各個星球的資料 render 到畫面上。</p>
<h4 id="⛳️-如何執行"><a href="#⛳️-如何執行" class="headerlink" title="⛳️ 如何執行"></a>⛳️ 如何執行</h4><p>使用 <code>fetch</code> 和 <code>useQuery</code> 達成任務！</p>
<p>接著我們就開始吧，首先，useQuery 使用上的參數有兩個：</p>
<blockquote>
<ul>
<li>A <strong>unique key for the query</strong></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>An <strong>asynchronous function (or similar then-able)</strong> to resolve the data</li>
</ul>
</blockquote>
<p>第一個參數必須是一個 unique 的 key，這個 key 可以是字串、陣列、或是物件，這邊為了簡單起見，就先隨便用個字串 <code>planets</code>；第二個參數則是 fetch data 時會用到的非同步 function，這個 function 就是平常你在 fetch data 時會寫的 function，所以我們就先寫成這樣：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> status<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token string">'planets'</span><span class="token punctuation">,</span>
    fetchPlanets
  <span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> status<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>很簡單，就是先寫個 asynchronous function，然後把 asynchronous function 當作參數傳入這樣。</p>
<p>接下來，講解一下 useQuery 執行後會回傳的內容：</p>
<blockquote>
<p>data：就是 fetch 後會得到的 response</p>
<p>status：分成三個類型的字串，<code>loading</code>、<code>success</code>、<code>error</code>，就是一般我們在 fetch 時會有的三種狀態</p>
<p>isLoading、isSuccess、isError：如果不喜歡 status 的用法的話，可以改用這些 flag</p>
</blockquote>
<p>因為我比較習慣 <code>isXXX</code> 這類的 flag 用法，在得到 data 之後我們可以寫成這樣：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token string">'planets'</span><span class="token punctuation">,</span>
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>噹啷！任務目標簡潔且優雅地完成了！這邊新增的 Planet Component 內容長這樣：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planet</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> planet <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">population: </span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>population<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">terrain : </span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>terrain<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再稍微調整 css 後畫面會這樣：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gift4o0wk1j31m00u078k.jpg" alt="截圖 2020-09-05 下午3.29.43"></p>
<p>畫面很醜我知道，但我盡力了，然後 <code>People.jsx</code> 要做的事情是差不多的，所以就不多贅述，這是完成後的 <a target="_blank" rel="noopener" href="https://codesandbox.io/s/blissful-poincare-vxqv8?file=/src/App.js">codesandbox</a>。</p>
<h4 id="所以…和-useFetch-Hook-差在哪呢？"><a href="#所以…和-useFetch-Hook-差在哪呢？" class="headerlink" title="所以…和 useFetch Hook 差在哪呢？"></a>所以…和 useFetch Hook 差在哪呢？</h4><p>現在 React Hook 也有人作出了各種 fetch data 相關的 custom hook，<code>useQuery</code> 用起來其實大同小異，但最大的差別是在於它背後幫你處理了 cache、deduping、updating  out of date data in the background 等各種事情。</p>
<p>所以你會發現到第一次 fetch 的時候會顯示短暫的 loading 畫面，但之後在「Planet」和「People」切換就順暢無比，因為 data 都從 cached 中取得。</p>
<h3 id="React-Query-DevTool"><a href="#React-Query-DevTool" class="headerlink" title="React Query DevTool"></a>React Query DevTool</h3><p>React Query 還有貼心的提供 Devtool 提供開發者詳細的檢視每個 query 執行的狀態，使用上也很簡單，首先安裝 react query devtools</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> react-query-devtools<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  接下來在 App.jsx import 進來：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ReactQueryDevtools <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query-devtools'</span> <span class="token comment">// 這行</span>
<span class="token keyword">import</span> Navbar <span class="token keyword">from</span> <span class="token string">'./components/Navbar'</span>
<span class="token keyword">import</span> Planets <span class="token keyword">from</span> <span class="token string">'./components/Planets'</span>
<span class="token keyword">import</span> People <span class="token keyword">from</span> <span class="token string">'./components/People'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'planets'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Star Wars Info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navbar</span></span> <span class="token attr-name">setPage</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>setPage<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>page <span class="token operator">===</span> <span class="token string">'planets'</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planets</span></span> <span class="token punctuation">/></span></span> <span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">People</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactQueryDevtools</span></span> <span class="token attr-name">initialIsOpen</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token boolean">false</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"> // 以及這行，initialIsOpen 就是設定是否預設為打開的狀態
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>打開目前 localhost 的頁面就可以看到下面的畫面：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giha9kf5brj31gi0u0tgv.jpg" alt="截圖 2020-09-06 下午10.07.38"></p>
<p>可以看到它提供了 Data、Query 的詳細設定、目前 Data 是 fresh、fetching、inactive 等等，如果發送了不同的 query，也會顯示每個 query 的狀態：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihabcdeeej31gi0u0gtl.jpg" alt="截圖 2020-09-06 下午10.09.06"></p>
<p>用起來蠻像 Redux Devtools 的！設定也超級簡單，安裝後 import 進來就好，介面更是簡潔直觀。</p>
<h3 id="如果想要分頁怎麼做？usePagination！"><a href="#如果想要分頁怎麼做？usePagination！" class="headerlink" title="如果想要分頁怎麼做？usePagination！"></a>如果想要分頁怎麼做？usePagination！</h3><h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>前面有很快速的提到，key 可以提供 strings、array、object 等型態，當我們遇到比較複雜的應用場景時，就可以試著用 array 或 object 來應付這些情形，下面就以分頁做範例。</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token comment">// output: 1</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://swapi.dev/api/planets/'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 傳入陣列 </span>
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>當我們把 useQuery 的第一個參數 key 改以陣列傳入時，asynchronous function 的參數值就會依照陣列的順序傳入值，以上面 <code>fetchPlanets</code> 的例子來說，它的第一個 parameter 的值就會是 <code>plaents</code>，第二個 parameter 則是 <code>page</code> ，也因為如此，我們多了更多彈性使用的空間。</p>
<p>舉例來說，我們可以開始作分頁了！</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.dev/api/planets/?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 新增了 page parameter</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 新增 page state</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> isSuccess <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">,</span> 
    fetchPlanets
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> // 增加一堆 button 改變 page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">page 3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        data<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>畫面會長這樣：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihbw2bgddg30nw0hghdt.gif" alt="Sep-06-2020 23-04-08"></p>
<p>上面做的改動很簡單，endpoint 新增 page parameter、page state 以及增加改變 page 的 button，但問題也很顯而易見：</p>
<ol>
<li>這樣新增 button 北七北七的（但這單純是我懶）</li>
<li>切換分頁的時候，會不停顯示 loading，除非 fetch 過一次，才會直接抓 cache 的 data 而不顯示 loading</li>
</ol>
<p>不停切換 loading 和新頁面，雖然一般來說是能夠容忍的，但 UX 似乎可以更好，為了增進 UX，接下來要使用 React Query 提供的另一個 API，就是 usePaginatedQuery！</p>
<h3 id="usePaginatedQuery"><a href="#usePaginatedQuery" class="headerlink" title="usePaginatedQuery"></a>usePaginatedQuery</h3><p>前面使用 <code>useQuery</code> 可以發現到它運作上沒什麼問題，很多的 Web App 也是這樣運作的，但美中不足的地方是 UI 會一直在 <code>success</code> 和 <code>loading</code> 之間切換，不過如果使用 <code>usePaginatedQuery</code>，則有幾個不同的地方：</p>
<ul>
<li><code>usePaginatedQuery</code> 不使用 <code>data</code>，而是改成 <code>resolvedData</code>。<code>resolvedData</code> 是會是上一次成功 fetch 的 query result，當你發送新分頁的 request 時，<code>resolvedData</code> 直到成功 fetch 前都會保持原本的 data，fetch 成功並拿到新的 data 後，<code>resolvedData</code> 才會變成最新的 data。</li>
<li>如果真的需要發送 request 的當下就要拿到 data，可以使用 <code>latestData</code> ，當你發送 request 到被 resolved 前，<code>latestData</code> 會是 <code>undefined</code> 直到 query resolved，所以運作方式就蠻像原本 <code>useQuery</code> 的 <code>data</code>。</li>
</ul>
<p>所以我們把原本 code 改動一下：</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> usePaginatedQuery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span>
<span class="token keyword">import</span> Planet <span class="token keyword">from</span> <span class="token string">'./Planet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetchPlanets</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.dev/api/planets/?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>page<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Planets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
    resolvedData<span class="token punctuation">,</span>
    latestData<span class="token punctuation">,</span>
    isLoading<span class="token punctuation">,</span>
    isError<span class="token punctuation">,</span>
    isSuccess<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">usePaginatedQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'planets'</span><span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">,</span> fetchPlanets<span class="token punctuation">)</span> <span class="token comment">// 從 useQuery 改成使用 usePaginatedQuery</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Planets</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevPage</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>prevPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> // 修改一下 button
        Previous Page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>page<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevPage</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token operator">!</span>latestData <span class="token operator">||</span> <span class="token operator">!</span>latestData<span class="token punctuation">.</span>next <span class="token operator">?</span> prevPage <span class="token operator">:</span> prevPage <span class="token operator">+</span> <span class="token number">1</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">
        Next Page
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isError <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Fetching error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>isSuccess <span class="token operator">&amp;&amp;</span>
        resolvedData<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">planet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Planet</span></span> <span class="token attr-name">planet</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>planet<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>附註一下，這邊 Previous Page Button 使用 <code>Math.max</code> 的目的是避免在第一頁的時候會被持續扣減到小於 1。</p>
<p>這時候操作上會變得像是這樣：</p>
<p><img data-src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gihczyiibeg30nw0hgqv5.gif" alt="Sep-06-2020 23-42-42"></p>
<p>好，改完之後我覺得 UX 有沒有變好呢？…我保持懷疑的態度，原因是原本 UI 的確是會在 loading 和完整的畫面切換（如果要有更好的 UX 應該會是用 Skeleton）；而改用 <code>usePaginatedQuery</code> 後，在 data 完成前，畫面都會保持原樣，所以使用者也可能會懷疑自己的操作到底有沒有成功，有 loading 的話至少還能知道自己操作有成功，只是需要等待。</p>
<h2 id="👉-結語"><a href="#👉-結語" class="headerlink" title="👉 結語"></a>👉 結語</h2><p>如同標題所言，這篇就是 Tutorial，介紹最基本的 API 和使用方式，但還有很多地方沒提及，比如更詳細的官方文件內容、<code>useMutation</code>、React Query 的 cache 怎麼運作等等。</p>
<h3 id="待研究的問題"><a href="#待研究的問題" class="headerlink" title="待研究的問題"></a>待研究的問題</h3><ul>
<li>useMuation 以及官方文件更詳細的內容</li>
<li>data 會 cache 在哪裡？</li>
<li>如果設定一個 staleTIme 後，在過期以前如果資料更新，React Query 會怎麼做？</li>
<li>如果要共用一份 data，只能用 custom hook 嗎？那假如有 Component A 和 B，都要用同一份 data，是否只能 call 兩次 API 呢？如果不想 call 兩次 API，那是不是只能放進 Redux 或 Context 的 Global State 呢？</li>
</ul>
<p>這些問題日後就來研究。</p>
<h2 id="👉-Refercences"><a href="#👉-Refercences" class="headerlink" title="👉 Refercences"></a>👉 Refercences</h2><p><a target="_blank" rel="noopener" href="https://react-query.tanstack.com/docs/overview">React Query Docs</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=x1rQ61otgtU&list=PL4cUxeGkcC9jpi7Ptjl5b50p9gLjOFani&index=1">The Net Ninjia - React Query Tutorial</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Front-End/" rel="tag"># Front-End</a>
              <a href="/tags/React/" rel="tag"># React</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/27/VSCode-Auto-Organize-Import/" rel="prev" title="VSCode 自動刪除沒屁用 import 以及排版">
                  <i class="fa fa-chevron-left"></i> VSCode 自動刪除沒屁用 import 以及排版
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/11/14/react-query-and-swr-cache-strategy/" rel="next" title="React Query、SWR 的 cache strategy & 淺談 source code">
                  React Query、SWR 的 cache strategy & 淺談 source code <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chih Yang</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  





<script>
NexT.utils.loadComments('.utterances-container', () => {
  const script = document.createElement('script');
  script.src = 'https://utteranc.es/client.js';
  script.setAttribute('repo', "ChihYang41/ChihYang41.github.io");
  script.setAttribute('issue-term', "title");
  script.setAttribute('theme', "github-light");
  script.crossOrigin = 'anonymous';
  script.async = true;
  document.querySelector('.utterances-container').appendChild(script);
});
</script>

</body>
</html>
